/*
 * generated by Xtext 2.11.0
 */
package edu.eci.prot.dsl2.generator

import com.google.inject.Inject
import edu.eci.prot.dsl2.dsl2.Entity
import edu.eci.prot.dsl2.dsl2.Feature
import edu.eci.prot.dsl2.generator.collections.JSModuleData
import java.util.ArrayList
import org.eclipse.emf.ecore.resource.Resource
import org.eclipse.xtext.generator.AbstractGenerator
import org.eclipse.xtext.generator.IFileSystemAccess2
import org.eclipse.xtext.generator.IGeneratorContext
import org.eclipse.xtext.naming.IQualifiedNameProvider
import evaluators.GeneralEvaluator

/**
 * Generates code from your model files on save.
 * 
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#code-generation
 */
class Dsl2Generator extends AbstractGenerator {
	@Inject extension IQualifiedNameProvider
	Entity classToServe;
	ArrayList<Feature> principalEmbeddableFeatures=new ArrayList<Feature>();
	ArrayList<JSModuleData> appJSModules=new ArrayList<JSModuleData>();
	ArrayList<Feature> diagnostics=new ArrayList<Feature>();
	ArrayList<Feature> comments=new ArrayList<Feature>();
	override void doGenerate(Resource resource, IFileSystemAccess2 fsa, IGeneratorContext context) {
		//Create POJO entities
		for (e : resource.allContents.toIterable.filter(Entity)) {
			if(e.principal){
				classToServe=e;
				for (Feature f : e.features) {
					if(!f.many){
						principalEmbeddableFeatures.add(f);	
					}
				}
			}
		}
		if(classToServe!==null){
			for (e : resource.allContents.toIterable.filter(Entity)) {
				
				fsa.generateFile(
	                e.fullyQualifiedName.toString("/") + ".java",
	                e.compile)
				//Create Register Investigators Views
		        for (Feature fea : e.features) {
		        	//Finding diagnostics
		        	if(fea.diagnostic){
		        		diagnostics.add(fea);
		        		
		        		//Add InvestigatorView Path
		        		
		        		appJSModules.add(new JSModuleData("/static/app/RegistersInvestigatorView"+fea.name.toFirstUpper+"/RegistersInvestigatorView"+fea.name.toFirstUpper+".js",
		        			"myApp."+"RegistersInvestigatorView"+fea.name.toFirstUpper,
		        			"RegistersInvestigatorView"+fea.name.toFirstUpper+"/"+"RegistersInvestigatorView"+fea.name.toFirstUpper+".js"))
	        			
	        			//Create InvestigatorRegister View
	        			
		        		fsa.generateFile("/static/app/RegistersInvestigatorView"+fea.name.toFirstUpper+"/"+"RegistersInvestigatorView"+fea.name.toFirstUpper+".html",
	                	fea.compileRegistersInvestigatorViewHtml);
	                	fsa.generateFile("/static/app/RegistersInvestigatorView"+fea.name.toFirstUpper+"/"+"RegistersInvestigatorView"+fea.name.toFirstUpper+".js",
	                	fea.compileRegistersInvestigatorViewJS);
	                	
	                	//Add RegisterDoctorView Path
	                	
		        		
		        		appJSModules.add(new JSModuleData("/static/app/RegisterDoctorView"+fea.name.toFirstUpper+"/RegisterDoctorView"+fea.name.toFirstUpper+".js",
		        			"myApp.RegisterDoctorView"+fea.name.toFirstUpper,
		        			"RegisterDoctorView"+fea.name.toFirstUpper+"/RegisterDoctorView"+fea.name.toFirstUpper+".js"))
	                	
	                	//Create RegisterDoctorView
	                	
	                	fsa.generateFile("/static/app/RegisterDoctorView"+fea.name.toFirstUpper+"/"+"RegisterDoctorView"+fea.name.toFirstUpper+".html",
	                	fea.compileRegisterDoctorViewHtml);
	                	fsa.generateFile("/static/app/RegisterDoctorView"+fea.name.toFirstUpper+"/"+"RegisterDoctorView"+fea.name.toFirstUpper+".js",
	                	fea.compileRegisterDoctorViewJS);
	                	
		        		//Add ControlRegister (Patient) Path
		        		
		        		appJSModules.add(new JSModuleData("/static/app/ControlRegister"+fea.name.toFirstUpper+"/"+"ControlRegister"+fea.name.toFirstUpper+".js",
		        			"myApp.ControlRegister"+fea.name.toFirstUpper,
		        			"ControlRegister"+fea.name.toFirstUpper+"/"+"ControlRegister"+fea.name.toFirstUpper+".js"))
		        		
		        		//Create ControlRegister (Patient)
		        		
		        		fsa.generateFile("/static/app/ControlRegister"+fea.name.toFirstUpper+"/"+"ControlRegister"+fea.name.toFirstUpper+".html",
	                	fea.compileControlRegisterHtml);
	                	fsa.generateFile("/static/app/ControlRegister"+fea.name.toFirstUpper+"/"+"ControlRegister"+fea.name.toFirstUpper+".js",
	                	fea.compileControlRegisterJS);
	                	
	                	//Add ControlView (Patient) Path
	                	
		        		appJSModules.add(new JSModuleData("/static/app/ControlView"+fea.name.toFirstUpper+"/"+"ControlView"+fea.name.toFirstUpper+".js",
		        			"myApp.ControlView"+fea.name.toFirstUpper,
		        			"ControlView"+fea.name.toFirstUpper+"/"+"ControlView"+fea.name.toFirstUpper+".js"))

	                	//Create ControlView (Patient)
	                	
	                	fsa.generateFile("/static/app/ControlView"+fea.name.toFirstUpper+"/"+"ControlView"+fea.name.toFirstUpper+".html",
	                	fea.compileControlViewHtml);
	                	fsa.generateFile("/static/app/ControlView"+fea.name.toFirstUpper+"/"+"ControlView"+fea.name.toFirstUpper+".js",
	                	fea.compileControlViewJS);
	                	
	                	
		        	}else if(!fea.diagnostic&&fea.many){
		        		
		        		//Finding Comments
		        		comments.add(fea);
		        		
		        		//Add CommentsDoctorView Path
	                	
		        		
		        		appJSModules.add(new JSModuleData("/static/app/CommentsDoctorView"+fea.name.toFirstUpper+"/CommentsDoctorView"+fea.name.toFirstUpper+".js",
		        			"myApp.CommentsDoctorView"+fea.name.toFirstUpper,
		        			"CommentsDoctorView"+fea.name.toFirstUpper+"/CommentsDoctorView"+fea.name.toFirstUpper+".js"))
		        		
		        		//Create CommentsDoctorView
		        		
		        		fsa.generateFile("/static/app/CommentsDoctorView"+fea.name.toFirstUpper+"/"+"CommentsDoctorView"+fea.name.toFirstUpper+".html",
	                	fea.compileCommentsDoctorViewHtml);
	                	fsa.generateFile("/static/app/CommentsDoctorView"+fea.name.toFirstUpper+"/"+"CommentsDoctorView"+fea.name.toFirstUpper+".js",
	                	fea.compileCommentsDoctorViewJS);
		        		
		        		//Add CommentsDoctorView Path
	                	
		        		
		        		appJSModules.add(new JSModuleData("/static/app/CommentRegister"+fea.name.toFirstUpper+"/"+"CommentRegister"+fea.name.toFirstUpper+".js",
		        			"myApp.CommentRegister"+fea.name.toFirstUpper,
		        			"CommentRegister"+fea.name.toFirstUpper+"/"+"CommentRegister"+fea.name.toFirstUpper+".js"))
		        		
		        		//Create (Doctor) CommentRegister View
		        		
		        		fsa.generateFile("/static/app/CommentRegister"+fea.name.toFirstUpper+"/"+"CommentRegister"+fea.name.toFirstUpper+".html",
	                	fea.compileCommentRegisterHtml);
	                	fsa.generateFile("/static/app/CommentRegister"+fea.name.toFirstUpper+"/"+"CommentRegister"+fea.name.toFirstUpper+".js",
	                	fea.compileCommentRegisterJS);
		        		
		        		//Add CommentsView (Patient) Path
		        		
		        		appJSModules.add(new JSModuleData("/static/app/CommentsView"+fea.name.toFirstUpper+"/"+"CommentsView"+fea.name.toFirstUpper+".js",
		        			"myApp.CommentsView"+fea.name.toFirstUpper,
		        			"CommentsView"+fea.name.toFirstUpper+"/"+"CommentsView"+fea.name.toFirstUpper+".js"))
		        		
		        		//Create CommentsView (Patient)
		        		
		        		fsa.generateFile("/static/app/CommentsView"+fea.name.toFirstUpper+"/"+"CommentsView"+fea.name.toFirstUpper+".html",
	                	fea.compileCommentsViewHtml);
	                	fsa.generateFile("/static/app/CommentsView"+fea.name.toFirstUpper+"/"+"CommentsView"+fea.name.toFirstUpper+".js",
	                	fea.compileCommentsViewJS);
		        		
		        	}
		        }
	        }
	        
	        //Create services classes
	        
	        fsa.generateFile(
	            ((classToServe.fullyQualifiedName.toString("/").replace("/model/"+classToServe.name, "")) + "/services/"+ classToServe.name + "Services.java"),
	            classToServe.compileServiceInterface);
	        fsa.generateFile(
	            ((classToServe.fullyQualifiedName.toString("/").replace("/model/"+classToServe.name, "")) + "/services/"+ classToServe.name + "ServicesImpl1.java"),
	            classToServe.compileServiceImplementation);
            fsa.generateFile(
	            ((classToServe.fullyQualifiedName.toString("/").replace("/model/"+classToServe.name, "")) + "/services/"+ classToServe.name + "ServicesImpl2.java"),
	            classToServe.compileServiceImplementation2);
	        fsa.generateFile(
	            ((classToServe.fullyQualifiedName.toString("/").replace("/model/"+classToServe.name, "")) + "/controller/"+ classToServe.name + "Controller.java"),
	            classToServe.compileRESTControllers);
            fsa.generateFile(
	            ((classToServe.fullyQualifiedName.toString("/").replace("/model/"+classToServe.name, "")) + "/jpa/"+ classToServe.name + "Repository.java"),
	            classToServe.compileRepository);
            fsa.generateFile(
	            ((classToServe.fullyQualifiedName.toString("/").replace("/model/"+classToServe.name, "")) + "/jpa/"+ classToServe.name + "Service.java"),
	            classToServe.compileJpaService);
	        //Create JS Services
	        fsa.generateFile("/static/app/services/services.js", classToServe.compileJSServices);
	        
	        //Create Register
	        
	        fsa.generateFile("/static/app/Register/Register.html",
	    	classToServe.compileRegisterHtml);
	    	fsa.generateFile("/static/app/Register/Register.js",
	    	classToServe.compileRegisterJS);
	        
	        //Create HomeDoctor View
		
			fsa.generateFile("/static/app/HomeDoctor/HomeDoctor.html",
	    	classToServe.compileHomeDoctorHtml);
	    	fsa.generateFile("/static/app/HomeDoctor/HomeDoctor.js",
	    	classToServe.compileHomeDoctorJS);
	    	
	    	//Create HomePatient
	    	
	        fsa.generateFile("/static/app/HomePatient/HomePatient.html",
	    	classToServe.compileHomePatientHtml);
	        fsa.generateFile("/static/app/HomePatient/HomePatient.js",
	    	classToServe.compileHomePatientJS);
	    	
	    	//Create HomeInvestigator
	    	
	        fsa.generateFile("/static/app/HomeInvestigator/HomeInvestigator.html",
	    	classToServe.compileHomeInvestigatorHtml);
	        fsa.generateFile("/static/app/HomeInvestigator/HomeInvestigator.js",
	    	classToServe.compileHomeInvestigatorJS);
	    	
	    	//Create PatientProfile View
	    	
	    	fsa.generateFile("/static/app/PatientProfile/PatientProfile.html",
	    	classToServe.compilePatientProfileHtml);
	    	fsa.generateFile("/static/app/PatientProfile/PatientProfile.js",
	    	classToServe.compilePatientProfileJS);
	    	
	    	//Create DoctorProfile View
	    	
	    	fsa.generateFile("/static/app/DoctorProfile/DoctorProfile.html",
	    	classToServe.compileDoctorProfileHtml);
	    	fsa.generateFile("/static/app/DoctorProfile/DoctorProfile.js",
	    	classToServe.compileDoctorProfileJS);
	    	
	    	//Create InvestigatorProfile View
	    	
	    	fsa.generateFile("/static/app/InvestigatorProfile/InvestigatorProfile.html",
	    	classToServe.compileInvestigatorProfileHtml);
	    	fsa.generateFile("/static/app/InvestigatorProfile/InvestigatorProfile.js",
	    	classToServe.compileInvestigatorProfileJS);
	    	
	    	//Create UpdatePerson View
	    	
	    	fsa.generateFile("/static/app/Update"+classToServe.name+"/Update"+classToServe.name+".html",
	    	classToServe.compileUpdatePersonHtml);
	    	fsa.generateFile("/static/app/Update"+classToServe.name+"/Update"+classToServe.name+".js",
	    	classToServe.compileUpdatePersonJS);
	    	
	    	
	    	//Create Main Class
	    	
	    	fsa.generateFile((classToServe.fullyQualifiedName.toString("/").replace("/model/"+classToServe.name, "")) + "/demoApplication.java",
	    	classToServe.compileMainClass);
	    	
	    	//Create Investigator Template
	        fsa.generateFile("/static/app/Templates/templateInvestigator.js",
	    	diagnostics.compileTemplateInvestigatorViewJS);
	    	fsa.generateFile("/static/app/Templates/templateInvestigator.html",
	    	diagnostics.compileTemplateInvestigatorViewHtml);
	    	
	    	//Create DoctorTemplate
	    	fsa.generateFile("/static/app/Templates/templateDoctor.js",
	    	comments.compileTemplateDoctorViewJS);
	    	fsa.generateFile("/static/app/Templates/templateDoctor.html",
	    	comments.compileTemplateDoctorViewHtml);
	    	
	    	//Create Patient Template
	    	
	    	fsa.generateFile("/static/app/Templates/templatePatient.js",
	    	diagnostics.compileTemplatePatientJS);
	    	fsa.generateFile("/static/app/Templates/templatePatient.html",
	    	diagnostics.compileTemplatePatientHtml);
	    	
	    	//Create PatientAutorization
	    	
	    	fsa.generateFile("/static/app/PatientAutorization/PatientAutorization.html",
	    	classToServe.compilePatientAutorizationHtml);
	    	fsa.generateFile("/static/app/PatientAutorization/PatientAutorization.js",
	    	classToServe.compilePatientAutorizationJS);
	    	
	    	//create app.js & index.html
		   	fsa.generateFile(
		            "/static/app/app.js",
		            appJSModules.compileAppJS);
	        fsa.generateFile(
		            "/static/app/index.html",
		            appJSModules.compileIndexHtml);
		            
            //Create LoginView
            fsa.generateFile("/static/app/Login/Login.js",
	    	classToServe.compileLoginViewJS);
	    	fsa.generateFile("/static/app/Login/Login.html",
	    	classToServe.compileLoginViewHtml);
        }
	   	
    	//Clear actual collections
    	comments.clear;
	   	appJSModules.clear;
	   	diagnostics.clear;
	}
	
	//Create HomeInvestigator
	
	def compileHomeInvestigatorJS(Entity principal)
	'''
	'use strict';
	
	angular.module('myApp.HomeInvestigator', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/HomeInvestigator', {
	    templateUrl: 'HomeInvestigator/HomeInvestigator.html',
	    controller: 'HomeInvestigatorCtrl'
	  });
	}])
	
	.controller('HomeInvestigatorCtrl', ['«principal.name.toFirstLower»', '$rootScope', '$scope', function («principal.name.toFirstLower», $rootScope, $scope) {
	    «principal.name.toFirstLower».get({«principal.name.toFirstLower»Id:""+$rootScope.id«principal.name»})
	    .$promise.then(
	            //success
	            function( value ){
	                $scope.«principal.name.toFirstLower»H=value;
	            },
	            //error
	            function( error ){
	                alert("El Identificador no se encuentra registrado");
	            }
	    );
	}]);
	'''
	
	def compileHomeInvestigatorHtml(Entity principal)
	'''
	<div ng-include="'/app/Templates/templateInvestigator.html'"></div>
	<div id="page-wrapper">
	    <div class="row">
	        <div class="col-lg-12">
	            <h1 class="page-header">Bienvenido {{«principal.name.toFirstLower»H.name}}</h1>
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	    <!-- /.row -->
	    <div class="row">
	        <div class="col-lg-12">
	            <div class="panel panel-default">
	                <div class="panel-heading">
	                    Descripcion del Estudio
	                </div>
	                <!-- /.panel-heading -->
	                <div class="panel-body">
	                    <p>En esta aplicacion encontrara datos promedios de los registros realizados por los participantes del estudio.</p>
	                </div>
	                <!-- /.panel-body -->
	            </div>
	            <!-- /.panel -->
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	    <!-- /.row -->
	</div>
	<!-- /#page-wrapper -->
	
	</div>
	<!-- /#wrapper -->
	'''
	
	//Create PatientAutorization
	
	def compilePatientAutorizationJS(Entity principal)
	'''
	'use strict';
	
	angular.module('myApp.PatientAutorization', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/PatientAutorization', {
	    templateUrl: 'PatientAutorization/PatientAutorization.html',
	    controller: 'PatientAutorizationCtrl'
	  });
	}])
	
	.controller('PatientAutorizationCtrl', ['«principal.name.toFirstLower»', '$rootScope', 'new«principal.name»', '$scope', '$http', '$location', function(«principal.name.toFirstLower», $rootScope, new«principal.name», $scope, $http, $location) {
	    $scope.continueRegister=function(){
	        new«principal.name».save($rootScope.«principal.name.toFirstLower», function(){
	        $rootScope.id«principal.name»=$rootScope.«principal.name.toFirstLower».id;
	        $rootScope.authenticated = true;
	        «principal.name.toFirstLower».get({«principal.name.toFirstLower»Id:""+$rootScope.id«principal.name»})
	        .$promise.then(
	                //success
	                function( value ){
	                    alert("Registro Completado de "+ $rootScope.«principal.name.toFirstLower».name);
	                    $location.path("Login");
	                },
	                //error
	                function( error ){
	                    alert("El Identificador no se encuentra registrado");
	                }
	        );
	    });
	    }
	
	}]);
	'''
	
	def compilePatientAutorizationHtml(Entity principal)
	'''
	<div class="container">
	    <div class="row">
	        <div class="col-md-4 col-md-offset-4">
	            <div class="login-panel panel panel-default">
	                <div class="panel-heading">
	                    <h3 class="panel-title">Bienvenido a esta aplicacion de salud</h3>
	                    <label>Sus datos seran vistos unicamente por su medico y por los investigadores. Desea Continuar?</label>
	                </div>
	                <div class="panel-body">
	                    <form role="form">
	                        <fieldset>
	                            <!-- Change this to a button or input when using this as a form -->
	                            <a ng-click="continueRegister()" class="btn btn-lg btn-success btn-block">Autorizar y Continuar</a>
	                        </fieldset>
	                    </form>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>
	'''
	
	//Create UpdatePerson View
	
	def compileUpdatePersonJS(Entity principal)
	'''
	'use strict';
	
	angular.module('myApp.Update«principal.name»', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/Update«principal.name»', {
	    templateUrl: 'Update«principal.name»/Update«principal.name».html',
	    controller: 'Update«principal.name»Ctrl'
	  });
	}])
	
	.controller('Update«principal.name»Ctrl', ['$rootScope', '$scope','«principal.name.toFirstLower»', '«principal.name.toFirstLower»s','$http','$resource', '$location', function ($rootScope, $scope, «principal.name.toFirstLower», «principal.name.toFirstLower»s, $http, $resource, $location) {
			$scope.back=function(){
			    «principal.name.toFirstLower».get({«principal.name.toFirstLower»Id:""+$rootScope.id«principal.name»})
	            .$promise.then(
	                    //success
	                    function( value ){
	                        $scope.«principal.name.toFirstLower»A=value;
	                        if($scope.«principal.name.toFirstLower»A.role==("Paciente")){
	                            $location.path("HomePatient");
	                        }else if($scope.«principal.name.toFirstLower»A.role==("Doctor")){
	                            $location.path("HomeDoctor");
	                        }else if($scope.«principal.name.toFirstLower»A.role==("Investigador")){
	                            $location.path("HomeInvestigator");
	                        }
	                    },
	                    //error
	                    function( error ){
	                        alert("El Identificador no se encuentra registrado");
	                    }
	            );
			};
			«FOR Feature f: principal.features»
			«IF((f.transient)&&(f.type.eAllContents.toIterable.size==0))»
			$scope.«f.name»=null;
			«ELSEIF((!f.many)&&(f.type.eAllContents.toIterable.size>0))»
			«FOR dat: f.type.eAllContents.toIterable»
            «var feature =dat as Feature»
            «IF(feature.transient)»
            $scope.«f.name»«feature.name.toFirstUpper»=null;
            «ENDIF»
            «ENDFOR»
			«ENDIF»
			«ENDFOR»
	        $rootScope.nameP=null;
	
	        $scope.update= function(){
	            «principal.name.toFirstLower».get({«principal.name.toFirstLower»Id:""+$rootScope.id«principal.name»})
	                    .$promise.then(
	                            //success
	                            function( value ){
	                                $scope.«principal.name.toFirstLower»T=value;
	                                «FOR Feature f: principal.features»
	                    			«IF((f.transient)&&(f.type.eAllContents.toIterable.size==0))»
if($scope.«f.name»!=null&&$scope.«f.name»!=''){
	$scope.«principal.name.toFirstLower»T.«f.name»=$scope.«f.name»;
}
	                    			«ELSEIF((!f.many)&&(f.type.eAllContents.toIterable.size>0))»
	                    			«FOR dat: f.type.eAllContents.toIterable»
	                                «var feature =dat as Feature»
	                                «IF(feature.transient)»
	                                if($scope.«f.name»«feature.name.toFirstUpper»!=null){
	                                    $scope.«principal.name.toFirstLower»T.«f.name».«feature.name»=$scope.«f.name»«feature.name.toFirstUpper»;
	                                }
	                                «ENDIF»
	                                «ENDFOR»
	                    			«ENDIF»
	                    			«ENDFOR»
	                                «principal.name.toFirstLower»s.update($scope.«principal.name.toFirstLower»T)
	                                .$promise.then(
	                                    //success
	                                    function(value){
	                                        console.log("Registro Exitoso");
	                                        alert("Registro Exitoso");
	            							if($scope.«principal.name.toFirstLower»T.role==("Paciente")){
	                                            $location.path("HomePatient");
	                                        }else if($scope.«principal.name.toFirstLower»T.role==("Doctor")){
	                                            $location.path("HomeDoctor");
	                                        }else if($scope.«principal.name.toFirstLower»T.role==("Investigador")){
	                                            $location.path("HomeInvestigator");
	                                        }
	                                    },
	                                    //error
	                                    function( error ){
	                                        console.log("El paciente no se pudo actualizar");
	                                        alert("No se puedo registrar");
	                                    }
	
	                                );
	                            },
	                            //error
	                            function( error ){
	                                alert("El Identificador no se encuentra registrado");
	                            }
	                    );

	
	        };
	
	}]);
	'''
	
	def compileUpdatePersonHtml(Entity principal)
	'''
	<div id="wrapper">
	    <div id="page-wrapper">
	        <div class="row">
	            <div class="col-lg-12">
	                <h1 class="page-header">Registra tus datos</h1>
	            </div>
	            <!-- /.col-lg-12 -->
	        </div>
	        <!-- /.row -->
	        <div class="row">
	            <div class="col-lg-12">
	                <div class="panel panel-default">
	                    </div>
	                    <div class="panel-body">
	                        <div class="row">
	                            <div class="col-lg-6">
	                                <form role="form">
	                                    <div class="form-group">
											«FOR Feature f: principal.features»
	                                        	«IF((f.transient)&&(!f.name.equals("role"))&&(f.type.eAllContents.toIterable.size==0))»
		                                        «IF(f.type.name.equals("String"))»
<label> «f.name.toFirstUpper» </label>
<br><br>
<input type="text" ng-model="«f.name»">
<br><br>
		                                        «ELSEIF(f.type.name.equals("Integer"))»
<label> «f.name.toFirstUpper» </label>
<br><br>
<input type="number" ng-model="«f.name»">
<br><br>
		                                        «ELSEIF(f.type.name.equals("Date"))»
<label> «f.name.toFirstUpper» </label>
<br><br>
<input type="date" ng-model="«f.name»">
<br><br>
												«ENDIF»
		                                        «ELSEIF((!f.many)&&(f.type.eAllContents.toIterable.size>0))»
	                                        	<label><h2> Datos de «f.name.toFirstUpper» </h2></label>
	                                        	<br><br>
				                                        «FOR dat: f.type.eAllContents.toIterable»
					                                        «var feature =dat as Feature»
					                                        «IF(feature.transient)»
					                                        «IF(feature.type.name.equals("String"))»
					                                        <label> «feature.name.toFirstUpper» </label>
					                                        <br><br>
					                                        <input type="text" ng-model="«f.name»«feature.name.toFirstUpper»">
					                                        <br><br>
					                                        «ELSEIF(feature.type.name.equals("Integer"))»
					                                        <label> «feature.name.toFirstUpper» </label>
					                                        <br><br>
					                                        <input type="number" ng-model="«f.name»«feature.name.toFirstUpper»">
					                                        <br><br>
					                                        «ELSEIF(feature.type.name.equals("Date"))»
					                                        <label> «feature.name.toFirstUpper» </label>
					                                        <br><br>
					                                        <input type="date" ng-model="«f.name»«feature.name.toFirstUpper»">
					                                        <br><br>
					                                        «ENDIF»
					                                        «ENDIF»
				                                        «ENDFOR»
		                                        «ENDIF»
	                                        «ENDFOR»
	                                    </div>
	                                    <button type="submit" class="btn btn-default" ng-click="update()">Actualizar</button>
	                                    <button class="btn btn-default" ng-click="back()">Atras</button>
	                                    <button type="reset" class="btn btn-default">Reiniciar</button>
	                                </form>
	                            </div>
	                        </div>
	                        <!-- /.row (nested) -->
	                    </div>
	                    <!-- /.panel-body -->
	                </div>
	                <!-- /.panel -->
	            </div>
	            <!-- /.col-lg-12 -->
	        </div>
	        <!-- /.row -->
	    </div>
	    <!-- /#page-wrapper -->
	
	</div>
	<!-- /#wrapper -->
	'''
	
	//Create InvestigatorProfile View
	
	def compileInvestigatorProfileJS(Entity principal)
	'''
	'use strict';
	
	angular.module('myApp.InvestigatorProfile', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/InvestigatorProfile', {
	    templateUrl: 'InvestigatorProfile/InvestigatorProfile.html',
	    controller: 'InvestigatorProfileCtrl'
	  });
	}])
	
	.controller('InvestigatorProfileCtrl', ['$rootScope', '$scope', '«principal.name.toFirstLower»', '$location', function ($rootScope, $scope, «principal.name.toFirstLower»,$location) {
	
	    «principal.name.toFirstLower».get({«principal.name.toFirstLower»Id:""+$rootScope.id«principal.name»})
	                .$promise.then(
	                        //success
	                        function( value ){
	                            $scope.«principal.name.toFirstLower»=value;
	                        },
	                        //error
	                        function( error ){
	                            alert("El paciente no se encuentra registrado");
	                        }
	                );
	    $scope.continueUP=function(){
	        $location.path("UpdatePerson");
	    };
	
	}]);
	'''
	
	def compileInvestigatorProfileHtml(Entity principal)
	'''
	<div ng-include="'/app/Templates/templateInvestigator.html'"></div>
	<div id="page-wrapper">
	    <div class="row">
	        <div class="col-lg-12">
	            <h1 class="page-header">Tus Datos</h1>
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	    <!-- /.row -->
	    <div class="row">
	        <div class="col-lg-4">
	            <div class="panel panel-default">
	                <div class="panel-heading">
	                    Datos personales
	                </div>
	                <div class="panel-body">
	                    <h2> Numero de Identificacion
	                        <br><br>
	                        <small> {{«principal.name.toFirstLower».id}} </small>
	                    </h2>
	                    <br><br>
	
	                    <h2> Nombre
	                        <br><br>
	                        <small> {{«principal.name.toFirstLower».name}} </small>
	                    </h2>
	                    <br><br>
	
	                    «FOR Feature f: principal.features»
	                    «IF((!f.name.equals("password"))&&(!f.name.equals('id'))&&(!f.name.equals('name')))»
                        «IF((f.type.name.equals("String"))||(f.type.name.equals("Integer")))»
<h2> «f.name.toFirstUpper»
	                        <br><br>
	                        <small> {{«principal.name.toFirstLower».«f.name»}} </small>
	                    </h2>
	                    <br><br>
                        «ELSEIF(f.type.name.equals("Date"))»
<h2> «f.name.toFirstUpper»
	                        <br><br>
	                        <small> {{«principal.name.toFirstLower».«f.name» | date:'yyyy-MM-dd'}} </small>
	                    </h2>
	                    <br><br>
                        «ELSEIF((!f.many)&&(f.type.eAllContents.toIterable.size>0))»
                        <label><h1> Datos de «f.name.toFirstUpper» </h1></label>
                        <br><br>
                                «FOR dat: f.type.eAllContents.toIterable»
                                    «var feature =dat as Feature»
                                    «IF((feature.type.name.equals("String"))||(feature.type.name.equals("Integer")))»
<h2> «feature.name.toFirstUpper»
				                        <br><br>
				                        <small> {{«principal.name.toFirstLower».«f.name».«feature.name»}} </small>
				                    </h2>
				                    <br><br>
                                    «ELSEIF(feature.type.name.equals("Date"))»
<h2> «feature.name.toFirstUpper»
				                        <br><br>
				                        <small> {{«principal.name.toFirstLower».«f.name».«feature.name» | date:'yyyy-MM-dd'}} </small>
				                    </h2>
				                    <br><br>
                                    «ENDIF»
                                «ENDFOR»
                        «ENDIF»
                        «ENDIF»
	                    «ENDFOR»
	
	                    <button type="button" class="btn btn-primary btn-lg btn-block" ng-click="continueUP()">Actualizar Datos</button>
	                </div>
	                <!-- /.panel-body -->
	            </div>
	            <!-- /.panel -->
	        </div>
	        <!-- /.col-lg-4 -->
	    </div>
	    <!-- /.row -->
	</div>
	<!-- /#page-wrapper -->
	
	</div>
	<!-- /#wrapper -->
	'''
	
	//Create DoctorProfile View
	
	def compileDoctorProfileJS(Entity principal)
	'''
	'use strict';
	
	angular.module('myApp.DoctorProfile', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/DoctorProfile', {
	    templateUrl: 'DoctorProfile/DoctorProfile.html',
	    controller: 'DoctorProfileCtrl'
	  });
	}])
	
	.controller('DoctorProfileCtrl', ['$rootScope', '$scope', '«principal.name.toFirstLower»', '$location', function ($rootScope, $scope, «principal.name.toFirstLower»,$location) {
	
	    «principal.name.toFirstLower».get({«principal.name.toFirstLower»Id:""+$rootScope.id«principal.name»})
	                .$promise.then(
	                        //success
	                        function( value ){
	                            $scope.«principal.name.toFirstLower»=value;
	                        },
	                        //error
	                        function( error ){
	                            alert("El paciente no se encuentra registrado");
	                        }
	                );
	    $scope.continueUP=function(){
	        $location.path("UpdatePerson");
	    };
	
	}]);
	'''
	
	def compileDoctorProfileHtml(Entity principal)
	'''
	<div ng-include="'/app/Templates/templateDoctor.html'"></div>
	<div id="page-wrapper">
	    <div class="row">
	        <div class="col-lg-12">
	            <h1 class="page-header">Tus Datos</h1>
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	    <!-- /.row -->
	    <div class="row">
	        <div class="col-lg-4">
	            <div class="panel panel-default">
	                <div class="panel-heading">
	                    Datos personales
	                </div>
	                <div class="panel-body">
	                    <h2> Numero de Identificacion
	                        <br><br>
	                        <small> {{«principal.name.toFirstLower».id}} </small>
	                    </h2>
	                    <br><br>
	
	                    <h2> Nombre
	                        <br><br>
	                        <small> {{«principal.name.toFirstLower».name}} </small>
	                    </h2>
	                    <br><br>
	
	                    «FOR Feature f: principal.features»
	                    «IF((!f.name.equals("password"))&&(!f.name.equals('id'))&&(!f.name.equals('name')))»
                        «IF((f.type.name.equals("String"))||(f.type.name.equals("Integer")))»
<h2> «f.name.toFirstUpper»
	                        <br><br>
	                        <small> {{«principal.name.toFirstLower».«f.name»}} </small>
	                    </h2>
	                    <br><br>
                        «ELSEIF(f.type.name.equals("Date"))»
<h2> «f.name.toFirstUpper»
	                        <br><br>
	                        <small> {{«principal.name.toFirstLower».«f.name» | date:'yyyy-MM-dd'}} </small>
	                    </h2>
	                    <br><br>
                        «ELSEIF((!f.many)&&(f.type.eAllContents.toIterable.size>0))»
                        <label><h1> Datos de «f.name.toFirstUpper» </h1></label>
                        <br><br>
                                «FOR dat: f.type.eAllContents.toIterable»
                                    «var feature =dat as Feature»
                                    «IF((feature.type.name.equals("String"))||(feature.type.name.equals("Integer")))»
<h2> «feature.name.toFirstUpper»
				                        <br><br>
				                        <small> {{«principal.name.toFirstLower».«f.name».«feature.name»}} </small>
				                    </h2>
				                    <br><br>
                                    «ELSEIF(feature.type.name.equals("Date"))»
<h2> «feature.name.toFirstUpper»
				                        <br><br>
				                        <small> {{«principal.name.toFirstLower».«f.name».«feature.name» | date:'yyyy-MM-dd'}} </small>
				                    </h2>
				                    <br><br>
                                    «ENDIF»
                                «ENDFOR»
                        «ENDIF»
                        «ENDIF»
	                    «ENDFOR»
	
	                    <button type="button" class="btn btn-primary btn-lg btn-block" ng-click="continueUP()">Actualizar Datos</button>
	                </div>
	                <!-- /.panel-body -->
	            </div>
	            <!-- /.panel -->
	        </div>
	        <!-- /.col-lg-4 -->
	    </div>
	    <!-- /.row -->
	</div>
	<!-- /#page-wrapper -->
	
	</div>
	<!-- /#wrapper -->
	'''
	
	//Create PatientProfile View
	
	def compilePatientProfileJS(Entity principal)
	'''
	'use strict';
	
	angular.module('myApp.PatientProfile', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/PatientProfile', {
	    templateUrl: 'PatientProfile/PatientProfile.html',
	    controller: 'PatientProfileCtrl'
	  });
	}])
	
	.controller('PatientProfileCtrl', ['$rootScope', '$scope', '«principal.name.toFirstLower»', '$location', function ($rootScope, $scope, «principal.name.toFirstLower»,$location) {
	
	    «principal.name.toFirstLower».get({«principal.name.toFirstLower»Id:""+$rootScope.id«principal.name»})
	                .$promise.then(
	                        //success
	                        function( value ){
	                            $scope.«principal.name.toFirstLower»=value;
	                        },
	                        //error
	                        function( error ){
	                            alert("El paciente no se encuentra registrado");
	                        }
	                );
	    $scope.continueUP=function(){
	        $location.path("UpdatePerson");
	    };
	
	}]);
	'''
	
	def compilePatientProfileHtml(Entity principal)
	'''
	<div ng-include="'/app/Templates/templatePatient.html'"></div>
	<div id="page-wrapper">
	    <div class="row">
	        <div class="col-lg-12">
	            <h1 class="page-header">Tus Datos</h1>
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	    <!-- /.row -->
	    <div class="row">
	        <div class="col-lg-4">
	            <div class="panel panel-default">
	                <div class="panel-heading">
	                    Datos personales
	                </div>
	                <div class="panel-body">
	                    <h2> Numero de Identificacion
	                        <br><br>
	                        <small> {{«principal.name.toFirstLower».id}} </small>
	                    </h2>
	                    <br><br>
	
	                    <h2> Nombre
	                        <br><br>
	                        <small> {{«principal.name.toFirstLower».name}} </small>
	                    </h2>
	                    <br><br>
	
	                    «FOR Feature f: principal.features»
	                    «IF((!f.name.equals("password"))&&(!f.name.equals('id'))&&(!f.name.equals('name')))»
                        «IF((f.type.name.equals("String"))||(f.type.name.equals("Integer")))»
<h2> «f.name.toFirstUpper»
	                        <br><br>
	                        <small> {{«principal.name.toFirstLower».«f.name»}} </small>
	                    </h2>
	                    <br><br>
                        «ELSEIF(f.type.name.equals("Date"))»
<h2> «f.name.toFirstUpper»
	                        <br><br>
	                        <small> {{«principal.name.toFirstLower».«f.name» | date:'yyyy-MM-dd'}} </small>
	                    </h2>
	                    <br><br>
                        «ELSEIF((!f.many)&&(f.type.eAllContents.toIterable.size>0))»
                        <label><h1> Datos de «f.name.toFirstUpper» </h1></label>
                        <br><br>
                                «FOR dat: f.type.eAllContents.toIterable»
                                    «var feature =dat as Feature»
                                    «IF((feature.type.name.equals("String"))||(feature.type.name.equals("Integer")))»
<h2> «feature.name.toFirstUpper»
				                        <br><br>
				                        <small> {{«principal.name.toFirstLower».«f.name».«feature.name»}} </small>
				                    </h2>
				                    <br><br>
                                    «ELSEIF(feature.type.name.equals("Date"))»
<h2> «feature.name.toFirstUpper»
				                        <br><br>
				                        <small> {{«principal.name.toFirstLower».«f.name».«feature.name» | date:'yyyy-MM-dd'}} </small>
				                    </h2>
				                    <br><br>
                                    «ENDIF»
                                «ENDFOR»
                        «ENDIF»
                        «ENDIF»
	                    «ENDFOR»
	
	                    <button type="button" class="btn btn-primary btn-lg btn-block" ng-click="continueUP()">Actualizar Datos</button>
	                </div>
	                <!-- /.panel-body -->
	            </div>
	            <!-- /.panel -->
	        </div>
	        <!-- /.col-lg-4 -->
	    </div>
	    <!-- /.row -->
	</div>
	<!-- /#page-wrapper -->
	
	</div>
	<!-- /#wrapper -->
	'''
	
	
	//Create ControlView (Patient)
	
	def compileControlViewJS(Feature diagnostic)
	'''
	'use strict';
	
	angular.module('myApp.ControlView«diagnostic.name.toFirstUpper»', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/ControlView«diagnostic.name.toFirstUpper»', {
	    templateUrl: 'ControlView«diagnostic.name.toFirstUpper»/ControlView«diagnostic.name.toFirstUpper».html',
	    controller: 'ControlView«diagnostic.name.toFirstUpper»Ctrl'
	  });
	}])
	
	.controller('ControlView«diagnostic.name.toFirstUpper»Ctrl', ['$rootScope', '$scope', '«classToServe.name.toFirstLower»', function ($rootScope, $scope, «classToServe.name.toFirstLower») {
	    «classToServe.name.toFirstLower».get({«classToServe.name.toFirstLower»Id:""+$rootScope.id«classToServe.name»})
	    .$promise.then(
	            //success
	            function( value ){
	                $scope.«classToServe.name.toFirstLower»=value;
	                $scope.diagnostics=$scope.«classToServe.name.toFirstLower».«diagnostic.name»;
	                «FOR dat : diagnostic.type.eAllContents.toIterable»
                    «var feature=dat as Feature»
                    «IF(!feature.name.equals("date"))»
                    $scope.«feature.name»=[];
                    «ENDIF»
                    «ENDFOR»
					$scope.diagnosticsNew=[];
	                $scope.labels=[];
	                $scope.series = ['Datos de Control'];
	                $scope.diagnostics.orderByDate("date", -1);
					$scope.currentDate=new Date();
	                for(var n=0; n<$scope.diagnostics.length; n++){
	                    var dd=$scope.diagnostics[n];
	                    var datee=new Date(dd.date);
	                    if(datee >= ($scope.currentDate.setDate($scope.currentDate.getDate()-14))){
	                    	$scope.diagnosticsNew.push(dd);
	                    	«FOR dat : diagnostic.type.eAllContents.toIterable»
	                        «var feature=dat as Feature»
	                        «IF(feature.type.name.equals("Integer"))»
	                        $scope.«feature.name».push(dd.«feature.name»);
	                        «ENDIF»
	                        «ENDFOR»
		                    var datee=new Date(dd.date);
		                    var dia = datee.getDate();
		                    var mes = parseInt(datee.getMonth()) + 1;
		                    var year = datee.getFullYear();
		                    var dated=dia+"/"+mes+"/"+year;
		                    $scope.labels.push(dated);
	                    }else{
							break;
						}
	                }
	            },
	            //error
	            function( error ){
	                alert("Error");
	            }
	    );
		Array.prototype.orderByDate=function(p,so){
		  if(so!=-1&&so!=1)so=1;
		  this.sort(function(a,b){
		    var da=new Date(a[p]),db=new Date(b[p]);
		    return(da-db)*so;
		  })
		};
	}]);
	'''
	
	def compileControlViewHtml(Feature diagnostic)
	'''
	<div ng-include="'/app/Templates/templatePatient.html'"></div>
	<div id="page-wrapper">
	    <div class="row">
	        <div class="col-lg-12">
	            <h1 class="page-header">Tus datos de control de «diagnostic.name.toFirstUpper»</h1>
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	
	    <div class="row">
	        <div class="col-lg-12">
	            <div class="panel panel-default">
	                <div class="panel-heading">
	                </div>
	                <!-- /.panel-heading -->
	                <div class="panel-body">
						<label>Filtrar por: </label>
						<input type="text" ng-model="busqueda">
						<br><br>
	                    <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
	                        <thead>
	                        <tr>
	                            <th>Fecha de control</th>
	                            «FOR dat : diagnostic.type.eAllContents.toIterable»
	                            «var feature=dat as Feature»
	                            «IF(!feature.name.equals("date"))»
	                            <th>«feature.name.toFirstUpper»</th>
	                            «ENDIF»
	                            «ENDFOR»
	                        </tr>
	                        </thead>
	                        <tbody>
	                        <tr ng-repeat="d in diagnosticsNew | filter: busqueda" >
	                            <td>{{d.date | date:"dd/MMMM/yyyy"}}</td>
	                            «FOR dat : diagnostic.type.eAllContents.toIterable»
	                            «var feature=dat as Feature»
	                            «IF(!feature.name.equals("date"))»
	                            <td>{{d.«feature.name»}}</td>
	                            «ENDIF»
	                            «ENDFOR»
	                        </tr>
	                        </tbody>
	                    </table>
	                    <!-- /.table-responsive -->
	                </div>
	                <!-- /.panel-body -->
	            </div>
	            <!-- /.panel -->
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	    <!-- /.row -->
	    <div class="row">
		    «FOR dat : diagnostic.type.eAllContents.toIterable»
		    «var feature=dat as Feature»
		    «IF(feature.type.name.equals("Integer"))»
		    <div class="col-lg-4">
		    <div class="panel panel-default">
		    <div class="panel-heading">
		    «feature.name.toFirstUpper»
		    </div>
		    <div class="panel-body">
		    <canvas  id="«feature.name»" class="chart chart-bar"
		    chart-data="«feature.name»" chart-labels="labels" chart-series="series">
		    </canvas>
		    </div>
		    <!-- /.panel-body -->
		    </div>
		    <!-- /.panel -->
		    </div>
		    <!-- /.col-lg-4 -->
		    «ENDIF»
		    «ENDFOR»
	    </div>
	</div>
	<!-- /#page-wrapper -->
	'''
	
	
	//Create ControlRegister (Patient)
	
	def compileControlRegisterJS(Feature diagnostic)
	'''
	'use strict';
	
	angular.module('myApp.ControlRegister«diagnostic.name.toFirstUpper»', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/ControlRegister«diagnostic.name.toFirstUpper»', {
	    templateUrl: 'ControlRegister«diagnostic.name.toFirstUpper»/ControlRegister«diagnostic.name.toFirstUpper».html',
	    controller: 'ControlRegister«diagnostic.name.toFirstUpper»Ctrl'
	  });
	}])
	
	.controller('ControlRegister«diagnostic.name.toFirstUpper»Ctrl', ['$rootScope', '$scope', '«classToServe.name.toFirstLower»s','«classToServe.name.toFirstLower»','$http','$resource', '$location', function ($rootScope, $scope, «classToServe.name.toFirstLower»s,«classToServe.name.toFirstLower», $http, $resource, $location) {
			$scope.date=null;
			«FOR dat:diagnostic.type.eAllContents.toIterable»
			«var feature =dat as Feature»
			«IF(!feature.name.equals("date"))»
			$scope.«feature.name»=null;
			«ENDIF»
			«ENDFOR»
	
	        $scope.saveRegister= function(){
	            $scope.diagnostic={"date":$scope.date
	            «FOR dat:diagnostic.type.eAllContents.toIterable»
				«var feature =dat as Feature»
				«IF(!feature.name.equals("date"))»
				, "«feature.name»":$scope.«feature.name»
				«ENDIF»
				«ENDFOR»
	            };
	            «classToServe.name.toFirstLower».get({«classToServe.name.toFirstLower»Id:""+$rootScope.id«classToServe.name»})
	            .$promise.then(
	                    //success
	                    function( value ){
	                        $scope.«classToServe.name.toFirstLower»T=value;
	                        $scope.«classToServe.name.toFirstLower»T.«diagnostic.name».push($scope.diagnostic);
	                        «classToServe.name.toFirstLower»s.update($scope.«classToServe.name.toFirstLower»T)
	                        .$promise.then(
	                            //success
	                            function(value){
	                                console.log("Patient update"+ $scope.«classToServe.name.toFirstLower»T.«diagnostic.name»);
	                                $location.path("HomePatient");
	                            },
	                            //error
	                            function( error ){
	                                console.log("El «classToServe.name.toFirstLower» no se pudo actualizar");
	                            }
	
	                        );
	                    },
	                    //error
	                    function( error ){
	                        alert("El Identificador no se encuentra registrado");
	                    }
	            );
	        };
	}]);
	'''
	
	def compileControlRegisterHtml(Feature diagnostic)
	'''
	<div ng-include="'/app/Templates/templatePatient.html'"></div>
	<div id="wrapper">
	    <div id="page-wrapper">
	        <div class="row">
	            <div class="col-lg-12">
	                <h1 class="page-header">Registra los datos de tu control de «diagnostic.name.toFirstUpper»</h1>
	            </div>
	            <!-- /.col-lg-12 -->
	        </div>
	        <!-- /.row -->
	        <div class="row">
	            <div class="col-lg-12">
	                <div class="panel panel-default">
	                    <div class="panel-heading">
	                    </div>
	                    <div class="panel-body">
	                        <div class="row">
	                            <div class="col-lg-6">
	                                <form role="form">
	                                    <div class="form-group">
	
	                                        <label>Fecha del control</label>
	                                        <br><br>
	                                        <input type="date" ng-model="date">
	                                        <br><br>
	
	                                        «FOR dat:diagnostic.type.eAllContents.toIterable»
                                			«var feature =dat as Feature»
                                			«IF((feature.type.name.equals("Date"))&&(!feature.name.equals("date")))»
                                			<label>«feature.name.toFirstUpper»</label>
                                			<br><br>
                                			<input type="date" ng-model="«feature.name»">
                                			<br><br>
                                			«ELSEIF(feature.type.name.equals("Integer")||feature.type.name.equals("Float"))»
                                			<label> «feature.name.toFirstUpper» </label>
                                			<br><br>
                                			<input type="number" ng-model="«feature.name»">
                                			<br><br>
                                			«ELSEIF(feature.type.name.equals("String"))»
                                			<label> «feature.name.toFirstUpper» </label>
                                			<br><br>
                                			<input type="String" ng-model="«feature.name»">
                                			<br><br>
                                			«ENDIF»
                                			«ENDFOR»
	                                    </div>
	                                    <button type="submit" class="btn btn-default" ng-click="saveRegister()">Aceptar</button>
	                                    <button type="reset" class="btn btn-default">Reiniciar</button>
	                                </form>
	                            </div>
	                        </div>
	                        <!-- /.row (nested) -->
	                    </div>
	                    <!-- /.panel-body -->
	                </div>
	                <!-- /.panel -->
	            </div>
	            <!-- /.col-lg-12 -->
	        </div>
	        <!-- /.row -->
	    </div>
	    <!-- /#page-wrapper -->
	
	</div>
	<!-- /#wrapper -->
	''' 
	
	//Create CommentsView (Patient)
	
	def compileCommentsViewJS(Feature comment)
	'''
	'use strict';
	
	angular.module('myApp.CommentsView«comment.name.toFirstUpper»', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/CommentsView«comment.name.toFirstUpper»', {
	    templateUrl: 'CommentsView«comment.name.toFirstUpper»/CommentsView«comment.name.toFirstUpper».html',
	    controller: 'CommentsView«comment.name.toFirstUpper»Ctrl'
	  });
	}])
	
	.controller('CommentsView«comment.name.toFirstUpper»Ctrl', ['$rootScope', '$scope', '«classToServe.name.toFirstLower»', function ($rootScope, $scope, «classToServe.name.toFirstLower») {
	
	     «classToServe.name.toFirstLower».get({«classToServe.name.toFirstLower»Id:""+$rootScope.id«classToServe.name»})
	                .$promise.then(
	                        //success
	                        function( value ){
	                            $scope.«classToServe.name.toFirstLower»C=value;
	                            $scope.comments=$scope.«classToServe.name.toFirstLower»C.«comment.name»;
	                            if (typeof $scope.comments == "undefined"){
	                                $scope.commentsY=false;
	                                $scope.commentsTitle="No tienes ningun comentario";
	                            }
	                            if(typeof $scope.comments != "undefined"){
	                                $scope.commentsY=true;
	                            }
	                        },
	                        //error
	                        function( error ){
	                            alert("Identificador no se encuentra registrado");
	                        }
	                );
	
	}]);
	'''
	
	def compileCommentsViewHtml(Feature comment)
	'''
	<div ng-include="'/app/Templates/templatePatient.html'"></div>
	<div id="page-wrapper">
	    <div class="row">
	        <div class="col-lg-12">
	            <h1 class="page-header">Comentarios de «comment.name.toFirstUpper»</h1>
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	
	    <div class="row">
	        <div class="col-lg-12">
	            <div class="panel panel-default">
	                <div class="panel-heading">
	                </div>
	                <!-- /.panel-heading -->
	                <div class="panel-body">
	                    <div ng-hide="commentsY">
	                        {{commentsTitle}}
	                    </div>
	                    <div ng-show="commentsY">
	                        <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
	                            <thead>
	                            <tr>
	                                <th>Comentarios «comment.name.toFirstUpper»</th>
	                            </tr>
	                            </thead>
	                            <tbody>
	                            <tr ng-repeat="c in comments" >
	                                <td>
	                                    <div class="panel panel-green">
											«FOR dat: comment.type.eAllContents.toIterable»
                    	                    «var feature =dat as Feature»
                    	                    «IF(feature.type.name.equals("Date"))»
                    	                    <div class="panel-footer">
                    	                    	«feature.name.toFirstUpper»: {{c.«feature.name» | date:"dd/MMMM/yyyy"}}
                    	                    </div>
                    	                    «ELSE»
                    	                    <div class="panel-heading">
                    	                    	«feature.name.toFirstUpper»: {{c.«feature.name»}}
                    	                    </div>
                    	                    «ENDIF»
                    	                    «ENDFOR»
	                                    </div>
	                                </td>
	                            </tr>
	                            </tbody>
	                        </table>
	                        <!-- /.table-responsive -->
	                    </div>
	                </div>
	                <!-- /.panel-body -->
	            </div>
	            <!-- /.panel -->
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	    <!-- /.row -->
	</div>
	<!-- /#page-wrapper -->
	'''
	
	//Create HomePatient
	
	def compileHomePatientJS(Entity principal)
	'''
	'use strict';
	
	angular.module('myApp.HomePatient', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/HomePatient', {
	    templateUrl: 'HomePatient/HomePatient.html',
	    controller: 'HomePatientCtrl'
	  });
	}])
	
	.controller('HomePatientCtrl', ['$rootScope', '$scope', '«principal.name.toFirstLower»', '$location', function ($rootScope, $scope, «principal.name.toFirstLower»,$location) {
	
	      «principal.name.toFirstLower».get({«principal.name.toFirstLower»Id:""+$rootScope.id«principal.name»})
	            .$promise.then(
	                    //success
	                    function( value ){
	                        $scope.«principal.name.toFirstLower»H=value;
	                        «FOR Feature comm: comments»
	                        $scope.commentsH«comm.name.toFirstUpper»=$scope.«principal.name.toFirstLower»H.«comm.name»;
	                        if (typeof $scope.commentsH«comm.name.toFirstUpper» == "undefined"){
	                            $scope.recomendacionesH«comm.name.toFirstUpper»="No tienes ninguna recomendacion sobre «comm.name.toFirstUpper»";
	                            $scope.cantH«comm.name.toFirstUpper»=undefined;
	                        }
	                        if(typeof $scope.commentsH«comm.name.toFirstUpper» != "undefined"){
	                            $scope.recomendacionesH«comm.name.toFirstUpper»="Comentarios sobre «comm.name.toFirstUpper» de tu medico!!";
	                            $scope.cantH«comm.name.toFirstUpper»=$scope.commentsH«comm.name.toFirstUpper».length;
	                        }
	                        «ENDFOR»

							«FOR Feature diag: diagnostics»
							$scope.diagnosticsH«diag.name.toFirstUpper»=$scope.«principal.name.toFirstLower»H.«diag.name»;
                            «FOR dat: diag.type.eAllContents.toIterable»
                                «var feature =dat as Feature»
                                «IF(feature.type.name.equals("Integer"))»
                                $scope.«feature.name»«diag.name.toFirstUpper»=[];
								«ENDIF»
                            «ENDFOR»
							$scope.labels«diag.name.toFirstUpper»=[];
							$scope.series«diag.name.toFirstUpper» = ['Datos de Control «diag.name.toFirstUpper»'];
							for(var n=0; n<$scope.diagnosticsH«diag.name.toFirstUpper».length; n++){
								var dd=$scope.diagnosticsH«diag.name.toFirstUpper»[n];
	                            «FOR dat: diag.type.eAllContents.toIterable»
	                                «var feature =dat as Feature»
	                                «IF(feature.type.name.equals("Integer"))»
	                                $scope.«feature.name»«diag.name.toFirstUpper».push(dd.«feature.name»);
	                                «ENDIF»
	                            «ENDFOR»
								var datee=new Date(dd.date);
								var dia = datee.getDate();
								var mes = parseInt(datee.getMonth()) + 1;
								var year = datee.getFullYear();
								var dated=dia+"/"+mes+"/"+year;
								$scope.labels«diag.name.toFirstUpper».push(dated);
							}
							«ENDFOR»
	                    },
	                    //error
	                    function( error ){
	                        alert("El Identificador no se encuentra registrado");
	                    }
	            );
	            «FOR Feature comm: comments»
$scope.continueCS«comm.name.toFirstUpper»=function(){
	          	$location.path("CommentsView«comm.name.toFirstUpper»");
	          	};
	            «ENDFOR»
	}]);
	'''
	
	def compileHomePatientHtml(Entity principal)
	'''
	<div ng-include="'/app/Templates/templatePatient.html'"></div>
	<div id="page-wrapper">
	    <div class="row">
	        <div class="col-lg-12">
	            <h1 class="page-header">Bienvenido {{«principal.name.toFirstLower»H.name}}</h1>
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	    «FOR Feature comm: comments»
	    <!-- /.row -->
	    <div class="row">
	        <div class="col-lg-3 col-md-6">
	            <div class="panel panel-primary">
	                <div class="panel-heading">
	                    <div class="row">
	                        <div class="col-xs-3">
	                            <i class="fa fa-comments fa-5x"></i>
	                        </div>
	                        <div class="col-xs-9 text-right">
	                            <div class="huge">{{cantH«comm.name.toFirstUpper»}}</div>
	                            <div>{{recomendacionesH«comm.name.toFirstUpper»}}</div>
	                        </div>
	                    </div>
	                </div>
	                <a  ng-click="continueCS«comm.name.toFirstUpper»()">
	                    <div class="panel-footer">
	                        <span class="pull-left">Detalles</span>
	                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
	                        <div class="clearfix"></div>
	                    </div>
	                </a>
	            </div>
	        </div>
	    </div>
	    «ENDFOR»
		«FOR Feature diag: diagnostics»
		<div class="row">
			<br>
			<h2>Registros de «diag.name.toFirstUpper»</h2>
			<br>
	    	«FOR data: diag.type.eAllContents.toIterable»
	    	«var feature=data as Feature»
	    	«IF(feature.type.name.equals("Integer"))»
	    	<div class="col-lg-4">
	    	<div class="panel panel-default">
	    	<div class="panel-heading">
	                    «feature.name.toFirstUpper»
	    	</div>
	    	<div class="panel-body">
	    	<canvas  id="«feature.name»«diag.name.toFirstUpper»" class="chart chart-bar"
	    	chart-data="«feature.name»«diag.name.toFirstUpper»" chart-labels="labels«diag.name.toFirstUpper»" chart-series="series«diag.name.toFirstUpper»">
	    	</canvas>
	    	</div>
	    	<!-- /.panel-body -->
	    	</div>
	    	<!-- /.panel -->
	    	</div>
	    	<!-- /.col-lg-4 -->
	    	«ENDIF»
	    	«ENDFOR»
		</div>
		«ENDFOR»
	    <!-- /.row -->
	</div>
	<!-- /#page-wrapper -->
	
	</div>
	<!-- /#wrapper -->
	
	
	'''
	
	//Create PatientRegister
	
	def compileRegisterJS(Entity principal)
	'''
	'use strict';
	
	angular.module('myApp.Register', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/Register', {
	    templateUrl: 'Register/Register.html',
	    controller: 'RegisterCtrl'
	  });
	}])
	
	.controller('RegisterCtrl', ['«principal.name.toFirstLower»', 'new«principal.name»', '$rootScope', '$scope', '«principal.name.toFirstLower»s','$http','$resource', '$location', function («principal.name.toFirstLower», new«principal.name», $rootScope, $scope, «principal.name.toFirstLower»s, $http, $resource, $location) {
	        $scope.id=null;
	        $scope.name=null;
	        «FOR Feature f: principal.features»
			«IF((!f.many)&&(!f.name.equals('id'))&&(!f.name.equals('name')))»
			«IF(f.type.eAllContents.toIterable.size==0)»
$scope.«f.name»=null;
			«ELSEIF(f.type.eAllContents.toIterable.size>0)»
			«FOR dat:f.type.eAllContents.toIterable»
			«var feature =dat as Feature»
			$scope.«feature.name»=null;
			«ENDFOR»
			«ENDIF»
			«ENDIF»
			«ENDFOR»
	        $rootScope.nameP=null;
	        $scope.save= function(){
	            $rootScope.id«principal.name.toFirstUpper»=$scope.id;
	            $rootScope.«principal.name.toFirstLower»={"id":$scope.id,"name":$scope.name
				«FOR Feature f: principal.features»
				«IF((!f.many)&&(!f.name.equals('id'))&&(!f.name.equals('name')))»
				«IF(f.type.eAllContents.toIterable.size==0)»
				, "«f.name»":$scope.«f.name»
				«ELSEIF(f.type.eAllContents.toIterable.size>0)»
				, "«f.name»":{
				//«var count=f.type.eAllContents.toIterable.size»
				«FOR dat:f.type.eAllContents.toIterable»
				«var feature =dat as Feature»
				"«feature.name»":$scope.«feature.name»«IF(count>1)», «ENDIF»
				//«count--»
				«ENDFOR»
				}
				«ENDIF»
				«ELSEIF(f.many)»
				, "«f.name»":[]
				«ENDIF»
				«ENDFOR»
				};
				
				if($rootScope.«principal.name.toFirstLower».role=="Paciente"){
	                $location.path("PatientAutorization");
	            }else if($rootScope.«principal.name.toFirstLower».role=="Doctor"||$rootScope.«principal.name.toFirstLower».role=="Investigador"){
	            new«principal.name».save($rootScope.«principal.name.toFirstLower»,function(){
	                console.info("«principal.name» saved   "+ $rootScope.«principal.name.toFirstLower».name);
	                $rootScope.id«principal.name»=$rootScope.«principal.name.toFirstLower».id;
	                $rootScope.authenticated = true;
	                «principal.name.toFirstLower».get({«principal.name.toFirstLower»Id:""+$rootScope.id«principal.name»})
	                .$promise.then(
	                        //success
	                        function( value ){
	                        	alert("Registro Completado de "+ $rootScope.«principal.name.toFirstLower».name");
	                            $location.path("Login");
	                        },
	                        //error
	                        function( error ){
	                            alert("El Identificador no se encuentra registrado");
	                        }
	                );
	            });
	            };
	
	        };
			$scope.selectmenu=document.getElementById("roleS");
	        $scope.selectmenu.onchange=function(){
	            $scope.role = this.options[this.selectedIndex].text;
	        }
	}]);
	'''
	
	def compileRegisterHtml(Entity principal)
	'''
	<div id="wrapper">
	    <div id="page-wrapper">
	        <div class="row">
	            <div class="col-lg-12">
	                <h1 class="page-header">Nuevo Registro «principal.name»</h1>
	            </div>
	            <!-- /.col-lg-12 -->
	        </div>
	        <!-- /.row -->
	        <div class="row">
	            <div class="col-lg-12">
	                <div class="panel panel-default">
	                    </div>
	                    <div class="panel-body">
	                        <div class="row">
	                            <div class="col-lg-6">
	                                <form role="form">
	                                    <div class="form-group">
	                                        <label> Numero de identificacion </label>
	                                        <br><br>
	                                        <input type="number" ng-model="id">
	                                        <br><br>
	                                        <label> Nombre </label>
	                                        <br><br>
	                                        <input type="text" ng-model="name">
	                                        <br><br>
	                                        «FOR Feature f: principal.features»
	                                        	«IF((!f.name.equals("role"))&&(!f.many)&&(!f.name.equals('id'))&&(!f.name.equals('name')))»
	                                        	«IF(f.name.equals("password"))»
<label> «f.name.toFirstUpper» </label>
	                                        	<br><br>
												<input type="password" ng-model="«f.name»">
												<br><br>
		                                        «ELSEIF(f.type.name.equals("String"))»
<label> «f.name.toFirstUpper» </label>
	                                        	<br><br>
		                                        <input type="text" ng-model="«f.name»">
		                                        <br><br>
		                                        «ELSEIF(f.type.name.equals("Integer"))»
<label> «f.name.toFirstUpper» </label>
			                                        <br><br>
			                                        <input type="number" ng-model="«f.name»">
			                                        <br><br>
		                                        «ELSEIF(f.type.name.equals("Date"))»
<label> «f.name.toFirstUpper» </label>
			                                        <br><br>
			                                        <input type="date" ng-model="«f.name»">
			                                        <br><br>
		                                        «ELSEIF((!f.many)&&(f.type.eAllContents.toIterable.size>0))»
<label><h2> Datos de «f.name.toFirstUpper» </h2></label>
		                                        <br><br>
				                                        «FOR dat: f.type.eAllContents.toIterable»
					                                        «var feature =dat as Feature»
					                                        «IF(feature.type.name.equals("String"))»
					                                        <label> «feature.name.toFirstUpper» </label>
					                                        <br><br>
					                                        <input type="text" ng-model="«feature.name»">
					                                        <br><br>
					                                        «ELSEIF(feature.type.name.equals("Integer"))»
					                                        <label> «feature.name.toFirstUpper» </label>
					                                        <br><br>
					                                        <input type="number" ng-model="«feature.name»">
					                                        <br><br>
					                                        «ELSEIF(feature.type.name.equals("Date"))»
					                                        <label> «feature.name.toFirstUpper» </label>
					                                        <br><br>
					                                        <input type="date" ng-model="«feature.name»">
					                                        <br><br>
					                                        «ENDIF»
				                                        «ENDFOR»
		                                        «ENDIF»
		                                        «ENDIF»
	                                        «ENDFOR»
	                                        <h2> Rol </h2>
	                                        <select name="rol" id="roleS">
	                                            <option value="1">Seleccione</option>
	                                            <option value="2">Paciente</option>
	                                            <option value="3">Doctor</option>
	                                            <option value="4">Investigador</option>
	                                        </select>
	                                    </div>
	                                    <button type="submit" class="btn btn-default" ng-click="save()">Aceptar</button>
	                                    <button type="reset" class="btn btn-default">Reiniciar</button>
	                                </form>
	                            </div>
	                        </div>
	                        <!-- /.row (nested) -->
	                    </div>
	                    <!-- /.panel-body -->
	                </div>
	                <!-- /.panel -->
	            </div>
	            <!-- /.col-lg-12 -->
	        </div>
	        <!-- /.row -->
	    </div>
	    <!-- /#page-wrapper -->
	
	</div>
	<!-- /#wrapper -->
	'''
	
	//Create loginView
	
	def compileLoginViewJS(Entity principal)
	'''
	'use strict';
	
	angular.module('myApp.Login', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/Login', {
	    templateUrl: 'Login/Login.html',
	    controller: 'LoginCtrl'
	  });
	}])
	
	.controller('LoginCtrl', ['$rootScope', '$scope', '«principal.name.toFirstLower»','«principal.name.toFirstLower»s','$http','$resource', '$location', function ($rootScope, $scope, «principal.name.toFirstLower», «principal.name.toFirstLower»s, $http, $resource, $location) {
	        $scope.continueRegister=function(){
	                $location.path("Register");
	        }
	        $rootScope.logout = function () {
	          $http.post('/logout', {}).success(function () {
	              $rootScope.authenticated = false;
	              $location.path("/");
	          }).error(function (data) {
	              $rootScope.authenticated = false;
	          });
	        };
			var authenticate = function (credentials, callback) {
		        if(credentials){
		            $rootScope.id«principal.name»=credentials.username;
		            $rootScope.pas«principal.name»=credentials.password;
		        }
		         var headers = credentials ? {authorization: "Basic "
		                     + btoa("12dea96fec20593566ab75692c9949596833adc9" + ":" + "5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8")
		         } : {};
		         $http.get('user', {headers: headers}).then(function (data) {
		             if (data.data.name) {
		                 $rootScope.authenticated = true;
		             } else {
		                 $rootScope.authenticated = false;
		             }
		             callback && callback();
		         }, function () {
		             $rootScope.authenticated = false;
		             callback && callback();
		         });
		
		     };
		     
		     authenticate();
		              $scope.credentials = {};
		              $scope.login = function () {
		                  authenticate($scope.credentials, function () {
		                      if ($rootScope.authenticated) {
		                         $scope.error = false;
		                         «principal.name.toFirstLower».get({«principal.name.toFirstLower»Id:""+$rootScope.id«principal.name»})
		                         .$promise.then(
		                                 //success
		                                 function( value ){
		                                     $scope.«principal.name.toFirstLower»H=value;
		                                     if(($scope.«principal.name.toFirstLower»H.password==$rootScope.pas«principal.name»)){
		                                         if($scope.«principal.name.toFirstLower»H.role=="Paciente"){
		                                             $location.path("HomePatient");
		                                         }
		                                         if($scope.«principal.name.toFirstLower»H.role=="Doctor"){
		                                             $location.path("HomeDoctor");
		                                         }
		                                         if($scope.«principal.name.toFirstLower»H.role=="Investigador"){
		                                             $location.path("HomeInvestigator");
		                                         }
		                                     }else{
		                                         $rootScope.authenticated=false;
		                                         alert("El Identificador no se encuentra registrado");
		                                         $scope.error = true;
		                                         $rootScope.logout();
		                                     }
		                                 },
		                                 //error
		                                 function( error ){
		                                     $rootScope.authenticated=false;
		                                     alert("Autenticacion Fallida");
		                                     $scope.error = true;
		                                     $rootScope.logout();
		                                 }
		                         );
		                      } else {
		                          $scope.error = true;
		                          alert("Autenticación Fallida");
		                          $rootScope.logout();
		                      }
		                  });
		         };
	        
	}]);
	'''
	
	def compileLoginViewHtml(Entity principal)
	'''
	<div class="container">
	    <div class="row">
	        <div class="col-md-4 col-md-offset-4">
	            <div class="login-panel panel panel-default">
	                <div class="panel-heading">
	                    <h3 class="panel-title">Inicia sesion</h3>
	                </div>
	                <div class="panel-body">
	                    <form role="form">
	                        <fieldset>
	                            <div class="form-group">
	                                <label>Numero de Identificacion</label>
	                                <input class="form-control" type="number" ng-model="credentials.username" autofocus>
	                            </div>
	                            <div class="form-group">
								<label for="password">Clave:</label> <input type="password"
									class="form-control" id="password" name="password" ng-model="credentials.password"/>
								</div>
	                            <!-- Change this to a button or input when using this as a form -->
	                            <button ng-click="login()" class="btn btn-lg btn-success btn-block">Iniciar Sesion</button>
								<button ng-click="continueRegister()" class="btn btn-lg btn-link btn-block">Eres nuevo? Registrate!</button>
	                        </fieldset>
	                    </form>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>
	'''
	
	//Create TemplatePatient
	
	def compileTemplatePatientJS(ArrayList<Feature> diagnostics)
	'''
	'use strict';
	
	angular.module('myApp.templatePatient', ['ngRoute'])
	
	.controller('templatePatientCtrl', ['$rootScope', '$scope', '«classToServe.name.toFirstLower»', '$location', function ($rootScope, $scope, «classToServe.name.toFirstLower», $location) {
	
	      $scope.continuePerfil=function(){
	            $location.path("PatientProfile");
	      };
	      $scope.continueLogout=function(){
	            $rootScope.logout();
	      };
	      $scope.continueHome=function(){
	            $location.path("HomePatient");
	      };
	      
	      «FOR comm : comments»
	      $scope.continueComments«comm.name.toFirstUpper»=function(){
	      	$location.path("CommentsView«comm.name.toFirstUpper»");
	      };
	      «ENDFOR»
	      «FOR diag : diagnostics»
	      $scope.continueCRegister«diag.name.toFirstUpper»=function(){
	            $location.path("ControlRegister«diag.name.toFirstUpper»");
	      };
	      $scope.continueCView«diag.name.toFirstUpper»=function(){
	            $location.path("ControlView«diag.name.toFirstUpper»");
	      };
	      «ENDFOR»
	}]);
	'''
	
	def compileTemplatePatientHtml(ArrayList<Feature> diagnostics)
	'''
	<div ng-controller="templatePatientCtrl">
	    <!-- Navigation -->
	    <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
	        <div class="navbar-header">
	            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	                <span class="sr-only">Toggle navigation</span>
	                <span class="icon-bar"></span>
	                <span class="icon-bar"></span>
	                <span class="icon-bar"></span>
	            </button>
	            <a class="navbar-brand" href="index.html">Multiple Client</a>
	        </div>
	        <!-- /.navbar-header -->
	
	        <ul class="nav navbar-top-links navbar-right">
	            <li><a ng-click="continuePerfil()"><i class="fa fa-user fa-fw"></i> Perfil </a>
	            </li>
	            <li><a ng-click="continueLogout()"><i class="fa fa-sign-out fa-fw"></i> Cerrar Sesion</a>
	            </li>
	        </ul>
	        <!-- /.navbar-top-links -->
	
	        <div class="navbar-default sidebar" role="navigation">
	            <div class="sidebar-nav navbar-collapse">
	                <ul class="nav" id="side-menu">
	                    <li>
	                        <a ng-click="continueHome()"><i class="fa fa-dashboard fa-fw"></i>Inicio</a>
	                    </li>
	        			«FOR comm: comments»
	        			<li>
	        			<a ng-click="continueComments«comm.name.toFirstUpper»()"><i class="fa fa-edit fa-fw"></i> Comentarios para «comm.name.toFirstUpper»</a>
	        			</li>
            			«ENDFOR»
	                    <li>
	                        <a><i class="fa fa-bar-chart-o fa-fw"></i> Registros de Diagnostico</a>
	                        <ul class="nav nav-second-level">
	                        	«FOR diag : diagnostics»
	                        	<li>
	                        	<a ng-click="continueCRegister«diag.name.toFirstUpper»()">Nuevo Registro «diag.name.toFirstUpper»</a>
	                        	</li>
	                        	<li>
	                        	<a ng-click="continueCView«diag.name.toFirstUpper»()">Consultar Registros «diag.name.toFirstUpper»</a>
	                        	</li>
	                        	«ENDFOR»
	                        </ul>
	                        <!-- /.nav-second-level -->
	                    </li>
	                </ul>
	            </div>
	            <!-- /.sidebar-collapse -->
	        </div>
	        <!-- /.navbar-static-side -->
	    </nav>
	</div>
	'''
	
	//Create (Doctor) CommentRegister View
	
	def compileCommentRegisterJS(Feature comment)
	'''
	'use strict';
	
	angular.module('myApp.CommentRegister«comment.name.toFirstUpper»', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/CommentRegister«comment.name.toFirstUpper»', {
	    templateUrl: 'CommentRegister«comment.name.toFirstUpper»/CommentRegister«comment.name.toFirstUpper».html',
	    controller: 'CommentRegister«comment.name.toFirstUpper»Ctrl'
	  });
	}])
	
	.controller('CommentRegister«comment.name.toFirstUpper»Ctrl', ['$rootScope', '$scope', '«classToServe.name.toFirstLower»','«classToServe.name.toFirstLower»s','$http','$resource', '$location', function ($rootScope, $scope, «classToServe.name.toFirstLower», «classToServe.name.toFirstLower»s, $http, $resource, $location) {
	        $scope.title=null;
	        «FOR dat: comment.type.eAllContents.toIterable»
            «var feature =dat as Feature»
            «IF(!feature.name.equals("title")&&!feature.name.equals("date"))»
            $scope.«feature.name»=null;
            «ENDIF»
            «ENDFOR»
	        $scope.date=new Date();
	        $scope.pId=$rootScope.patientId;
	        $scope.foundC=$rootScope.FindID;
	        $scope.saveComment= function(){
	            $scope.comment={"date":$scope.date«FOR dat: comment.type.eAllContents.toIterable»
	                        «var feature =dat as Feature»
	                        «IF(!feature.name.equals("title")&&!feature.name.equals("date"))»
	                        ,"«feature.name»":$scope.«feature.name»
	                        «ENDIF»
	                        «ENDFOR» ,"title":$scope.title};
	            «classToServe.name.toFirstLower».get({«classToServe.name.toFirstLower»Id:""+$scope.pId})
	            .$promise.then(
	                    //success
	                    function( value ){
	                        $scope.principal=value;
	                        $scope.principal.«comment.name».push($scope.comment);
	                        «classToServe.name.toFirstLower»s.update($scope.principal)
	                        .$promise.then(
	                            //success
	                            function(value){
	                                $location.path("CommentsDoctorView«comment.name.toFirstUpper»");
	                            },
	                            //error
	                            function( error ){
	                                console.log("No se pudo actualizar");
	                            }
	
	                        );
	                    },
	                    //error
	                    function( error ){
	                        alert("Identificador no se encuentra registrado");
	                    }
	            );
	        };
	}]);
	'''
	
	def compileCommentRegisterHtml(Feature comment)
	'''
	<div ng-include="'/app/Templates/templateDoctor.html'"></div>
	<div id="wrapper" ng-show="foundC">
	    <div id="page-wrapper">
	        <div class="row">
	            <div class="col-lg-12">
	                <h1 class="page-header">Registra Comentario «comment.name.toFirstUpper»</h1>
	            </div>
	            <!-- /.col-lg-12 -->
	        </div>
	        <!-- /.row -->
	        <div class="row">
	            <div class="col-lg-12">
	                <div class="panel panel-default">
	                    <div class="panel-heading">
	                    </div>
	                    <div class="panel-body">
	                        <div class="row">
	                            <div class="col-lg-6">
	                                <form role="form">
	                                    <div class="form-group">
	                                        «FOR dat: comment.type.eAllContents.toIterable»
                    	                    «var feature =dat as Feature»
                    	                    «IF(feature.name.equals("title"))»
                    	                    <label> «feature.name.toFirstUpper» </label>
                    	                    <br><br>
                    	                    <input type="String" ng-model="«feature.name»">
                    	                    <br><br>
                    	                    «ELSEIF((!feature.name.equals("date"))&&(feature.type.name.equals("Date")))»
                    	                    <label> «feature.name.toFirstUpper» </label>
                    	                    <br><br>
                    	                    <input type="date" ng-model="«feature.name»">
                    	                    <br><br>
                    	                    «ELSEIF(feature.type.name.equals("Integer"))»
                    	                    <label> «feature.name.toFirstUpper» </label>
                    	                    <br><br>
                    	                    <input type="number" ng-model="«feature.name»">
                    	                    <br><br>
                    	                    «ELSEIF(feature.type.name.equals("String"))»
                    	                    <label> «feature.name.toFirstUpper» </label>
                    	                    <br><br>
                    	                    <textarea class="form-control" rows="3" ng-model="«feature.name»"></textarea>
                    	                    <br><br>
                    	                    «ENDIF»
                    	                    «ENDFOR»
	
	                                    </div>
	                                    <button type="submit" class="btn btn-default" ng-click="saveComment()">Aceptar</button>
	                                    <button type="reset" class="btn btn-default">Reiniciar</button>
	                                </form>
	                            </div>
	                        </div>
	                        <!-- /.row (nested) -->
	                    </div>
	                    <!-- /.panel-body -->
	                </div>
	                <!-- /.panel -->
	            </div>
	            <!-- /.col-lg-12 -->
	        </div>
	        <!-- /.row -->
	    </div>
	    <!-- /#page-wrapper -->
	
	</div>
	<!-- /#wrapper -->
	'''
	
	
	//Create CommentsDoctorView
	
	def compileCommentsDoctorViewJS(Feature comment)
	'''
	'use strict';
	
	angular.module('myApp.CommentsDoctorView«comment.name.toFirstUpper»', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/CommentsDoctorView«comment.name.toFirstUpper»', {
	    templateUrl: 'CommentsDoctorView«comment.name.toFirstUpper»/CommentsDoctorView«comment.name.toFirstUpper».html',
	    controller: 'CommentsDoctorView«comment.name.toFirstUpper»Ctrl'
	  });
	}])
	
	.controller('CommentsDoctorView«comment.name.toFirstUpper»Ctrl', ['$rootScope', '$scope', '«classToServe.name.toFirstLower»', function ($rootScope, $scope, «classToServe.name.toFirstLower») {
	     $scope.foundCD=$rootScope.FindID;
	     «classToServe.name.toFirstLower».get({«classToServe.name.toFirstLower»Id:""+$rootScope.patientId})
	                .$promise.then(
	                        //success
	                        function( value ){
	                            $scope.«classToServe.name.toFirstLower»C=value;
	                            $scope.comments=$scope.«classToServe.name.toFirstLower»C.«comment.name»;
	                            if (typeof $scope.comments == "undefined"){
	                                $scope.commentsY=false;
	                                $scope.commentsTitle="No tiene ningun comentario";
	                            }
	                            if(typeof $scope.comments != "undefined"){
	                                $scope.commentsY=true;
	                            }
	                        },
	                        //error
	                        function( error ){
	                            console.log("Identificador no se encuentra registrado");
	                        }
	                );
	
	}]);
	'''
	
	def compileCommentsDoctorViewHtml(Feature comment)
	'''
	<div ng-include="'/app/Templates/templateDoctor.html'"></div>
	<div id="page-wrapper" ng-show="foundCD">
	    <div class="row">
	        <div class="col-lg-12">
	            <h1 class="page-header">Comentarios de «comment.name.toFirstUpper»</h1>
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	
	    <div class="row">
	        <div class="col-lg-12">
	            <div class="panel panel-default">
	                <div class="panel-heading">
	                </div>
	                <!-- /.panel-heading -->
	                <div class="panel-body">
	                    <div ng-hide="commentsY">
	                        {{commentsTitle}}
	                    </div>
	                    <div ng-show="commentsY">
	                        <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
	                            <thead>
	                            <tr>
	                                <th>Comentarios «comment.name.toFirstUpper»</th>
	                            </tr>
	                            </thead>
	                            <tbody>
	                            <tr ng-repeat="c in comments" >
	                                <td>
	                                    <div class="panel panel-green">
	                                    	«FOR dat: comment.type.eAllContents.toIterable»
                    	                    «var feature =dat as Feature»
                    	                    «IF(feature.type.name.equals("Date"))»
                    	                    <div class="panel-footer">
                    	                    	«feature.name.toFirstUpper»: {{c.«feature.name» | date:"dd/MMMM/yyyy"}}
                    	                    </div>
                    	                    «ELSE»
                    	                    <div class="panel-heading">
                    	                    	«feature.name.toFirstUpper»: {{c.«feature.name»}}
                    	                    </div>
                    	                    «ENDIF»
                    	                    «ENDFOR»
	                                    </div>
	                                </td>
	                            </tr>
	                            </tbody>
	                        </table>
	                        <!-- /.table-responsive -->
	                    </div>
	                </div>
	                <!-- /.panel-body -->
	            </div>
	            <!-- /.panel -->
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	    <!-- /.row -->
	</div>
	<!-- /#page-wrapper -->
	'''
	
	//Create RegisterDoctorView
	
	def compileRegisterDoctorViewJS(Feature diagnostic)
	'''
	'use strict';
	
	angular.module('myApp.RegisterDoctorView«diagnostic.name.toFirstUpper»', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/RegisterDoctorView«diagnostic.name.toFirstUpper»', {
	    templateUrl: 'RegisterDoctorView«diagnostic.name.toFirstUpper»/RegisterDoctorView«diagnostic.name.toFirstUpper».html',
	    controller: 'RegisterDoctorView«diagnostic.name.toFirstUpper»Ctrl'
	  });
	}])
	
	.controller('RegisterDoctorView«diagnostic.name.toFirstUpper»Ctrl', ['$rootScope', '$scope', '«classToServe.name.toFirstLower»', '«classToServe.name.toFirstLower»s', function ($rootScope, $scope, «classToServe.name.toFirstLower», «classToServe.name.toFirstLower»s) {
	
	    $scope.foundRD=$rootScope.FindID;
	    «classToServe.name.toFirstLower».get({«classToServe.name.toFirstLower»Id:""+$rootScope.patientId})
	    .$promise.then(
	            //success
	            function( value ){
	                $scope.principal=value;
	                $scope.diagnostics=$scope.principal.«diagnostic.name»;
	                «FOR dat: diagnostic.type.eAllContents.toIterable»
                    «var feature =dat as Feature»
    				«IF((feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
    				$scope.«feature.name»=[];
                    «ENDIF»
                    «ENDFOR»
					$scope.diagnosticsNew=[];
	                $scope.labels=[];
	                $scope.series = ['Datos de Control «diagnostic.name.toFirstUpper»'];
	                $scope.diagnostics.orderByDate("date", -1);
					$scope.currentDate=new Date();
	                for(var n=0; n<$scope.diagnostics.length; n++){
	                    var dd=$scope.diagnostics[n];
	                    var datee=new Date(dd.date);
	                    if(datee >= ($scope.currentDate.setDate($scope.currentDate.getDate()-14))){
	                    	$scope.diagnosticsNew.push(dd);
	                    	«FOR dat: diagnostic.type.eAllContents.toIterable»
	                        «var feature =dat as Feature»
	        				«IF((feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
	        				$scope.«feature.name».push(dd.«feature.name»);
	                        «ENDIF»
	                        «ENDFOR»
		                    var datee=new Date(dd.date);
		                    var dia = datee.getDate();
		                    var mes = parseInt(datee.getMonth()) + 1;
		                    var year = datee.getFullYear();
		                    var dated=dia+"/"+mes+"/"+year;
		                    $scope.labels.push(dated);
						}else{
	                        break;
	                    }
	                }
	            },
	            //error
	            function( error ){
	                console.log("Error");
	            }
	    );
	    
	    Array.prototype.orderByDate=function(p,so){
	      if(so!=-1&&so!=1)so=1;
	      this.sort(function(a,b){
	        var da=new Date(a[p]),db=new Date(b[p]);
	        return(da-db)*so;
	      })
	    };
	
	}]);
	'''
	
	def compileRegisterDoctorViewHtml(Feature diagnostic)
	'''
	<div ng-include="'/app/Templates/templateDoctor.html'"></div>
	<div id="page-wrapper" ng-show="foundRD">
	    <div class="row">
	        <div class="col-lg-12">
	            <h1 class="page-header">Datos de control de {{principal.name}} para «diagnostic.name.toFirstUpper»</h1>
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	
	    <div class="row">
	        <div class="col-lg-12">
	            <div class="panel panel-default">
	                <div class="panel-heading">
	                </div>
	                <!-- /.panel-heading -->
	                <div class="panel-body">
	                	<label>Filtrar por:  </label>
						<input type="text" ng-model="busqueda">
						<br><br>
	                    <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
	                        <thead>
	                        <tr>
	                        	«FOR dat: diagnostic.type.eAllContents.toIterable»
			                    «var feature =dat as Feature»
	            				«IF((feature.type.name.equals("Date"))||(feature.type.name.equals("String"))||(feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
	            				<th>«dat.fullyQualifiedName.lastSegment.toFirstUpper»</th>
			                    «ENDIF»
			                    «ENDFOR»
	                        </tr>
	                        </thead>
	                        <tbody>
	                        <tr ng-repeat="d in diagnosticsNew | filter:busqueda" >
	                        	«FOR dat: diagnostic.type.eAllContents.toIterable»
                				«var feature =dat as Feature»
                				«IF((feature.type.name.equals("String"))||(feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
                				<td>{{d.«feature.name»}}</td>
                				«ENDIF»
                				«IF(feature.type.name.equals("Date"))»
                				<td>{{d.«feature.name» | date:"dd/MMMM/yyyy"}}</td>
                				«ENDIF»
                				«ENDFOR»
	                        </tr>
	                        </tbody>
	                    </table>
	                    <!-- /.table-responsive -->
	                </div>
	                <!-- /.panel-body -->
	            </div>
	            <!-- /.panel -->
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	    <div class="row">
	    	«FOR dat: diagnostic.type.eAllContents.toIterable»
			«var feature =dat as Feature»
			«IF((feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
			<div class="col-lg-4">
				<div class="panel panel-default">
					<div class="panel-heading">
						«feature.name.toFirstUpper»
					</div>
					<div class="panel-body">
						<canvas  id="«feature.name»" class="chart chart-bar"
							chart-data="«feature.name»" chart-labels="labels" chart-series="series">
						</canvas>
					</div>
				<!-- /.panel-body -->
				</div>
			<!-- /.panel -->
			</div>
			<!-- /.col-lg-4 -->
			«ENDIF»
			«ENDFOR»
	    </div>
	    <!-- /.row -->
	</div>
	<!-- /#page-wrapper -->
	'''
	
	
	//Create HomeDoctor View
	
	def compileHomeDoctorJS(Entity e)
	'''
	'use strict';
	
	angular.module('myApp.HomeDoctor', ['ngRoute'])
	
	.config(['$routeProvider', function($routeProvider) {
	  $routeProvider.when('/HomeDoctor', {
	    templateUrl: 'HomeDoctor/HomeDoctor.html',
	    controller: 'HomeDoctorCtrl'
	  });
	}])
	
	.controller('HomeDoctorCtrl', ['$rootScope', '$scope', '«e.name.toFirstLower»','$location', function ($rootScope, $scope, «e.name.toFirstLower»,$location) {
		«e.name.toFirstLower».get({«e.name.toFirstLower»Id:""+$rootScope.id«e.name»})
	    .$promise.then(
	            //success
	            function( value ){
	                $scope.«e.name.toFirstLower»H=value;
	            },
	            //error
	            function( error ){
	                alert("El Identificador no se encuentra registrado");
	            }
	    );
	    $rootScope.FindID=false;
	    $rootScope.patientId=null;
	    $scope.found=false;
	    $scope.pId=null;
	    $rootScope.patientId=$scope.pId;
	    $scope.consultar=function(){
	        $rootScope.patientId=$scope.pId;
	        «classToServe.name.toFirstLower».get({«e.name.toFirstLower»Id:""+$rootScope.patientId})
	        .$promise.then(
	                //success
	                function( value ){
	                    $rootScope.FindID=true;
	                    $scope.principal=value;
	                },
	                //error
	                function( error ){
	                    alert("Identificador no se encuentra registrado");
	                }
	        );
	
	    };
	    $scope.NuevaConsulta=function(){
	        $rootScope.FindID=false;
	    };
	
	}]);
	'''
	
	def compileHomeDoctorHtml(Entity e)
	'''
	<div ng-include="'/app/Templates/templateDoctor.html'"></div>
	<div id="page-wrapper">
	    <div class="row">
	        <div class="col-lg-12">
	        	<h1 class="page-header">Bienvenido {{«classToServe.name.toFirstLower»H.name}}</h1>
	            <br>
	            <br>
	            <h1 class="page-header">Consulta los datos de control</h1>
	        </div>
	        <!-- /.col-lg-12 -->
	        <div ng-hide="FindID">
	            <label> Identificador a consultar</label>
	            <br><br>
	            <input type="number" ng-model="pId">
	            <br><br>
	
	            <button type="button" class="btn btn-success" ng-click="consultar()">Consultar Datos</button>
	            <br><br>
	        </div>
	        <div ng-show="FindID">
	            <button type="button" class="btn btn-success" ng-click="NuevaConsulta()">Nueva Consulta</button>
	            <br><br>
	        </div>
	    </div>
	
	    <div class="row" ng-show="FindID">
	        <div class="col-lg-12">
	            <div class="panel panel-default">
	                <div class="panel-heading">
	                    Datos de {{principal.name}}
	                </div>
	                <div class="panel-body">
	                    <h2> Numero de Identificacion
	                        <br><br>
	                        <small> {{principal.id}} </small>
	                    </h2>
	                    <br><br>
	                    «FOR f : e.features»
	                    «IF((!f.many)&&(f.type.eAllContents.toIterable.size==0)&&(!f.name.equals("password")&&!f.name.equals("id")))»
	                    «IF((f.type.name.equals("String"))||(f.type.name.equals("Integer")))»
	                    <h2> «f.name.toFirstUpper»
	                        <br><br>
	                        <small> {{principal.«f.name»}} </small>
	                    </h2>
	                    <br><br>
	                    «ELSEIF(f.type.name.equals("Date"))»
	                    <h2> «f.name.toFirstUpper»
	                        <br><br>
	                        <small> {{principal.«f.name» | date:'yyyy-MM-dd'}} </small>
	                    </h2>
	                    <br><br>
	                    «ENDIF»
	                    «ELSEIF((!f.many)&&(f.type.eAllContents.toIterable.size>0))»
	                    <label><h1> Datos de «f.name.toFirstUpper» </h1></label>
	                    <br><br>
                                «FOR dat: f.type.eAllContents.toIterable»
                                    «var feature =dat as Feature»
                                    «IF((feature.type.name.equals("String"))||(feature.type.name.equals("Integer")))»
                                    <h2> «feature.name»
                                    <br><br>
                                    <small> {{principal.«f.name».«feature.name»}} </small>
                                    </h2>
                                    <br><br>
                                    «ELSEIF((feature.type.name.equals("Date")))»
                                    <h2> «feature.name»
                                    <br><br>
                                    <small> {{principal.«f.name».«feature.name» | date:'yyyy-MM-dd'}} </small>
                                    </h2>
                                    <br><br>
                                    «ENDIF»
                                «ENDFOR»
	                    «ENDIF»
	                    «ENDFOR»
	                </div>
	                <!-- /.panel-body -->
	            </div>
	            <!-- /.panel -->
	        </div>
	        <!-- /.col-lg-12 -->
	    </div>
	    <!-- /.row -->
	</div>
	<!-- /#page-wrapper -->
	'''
	
	//Create TemplateDoctorView
	
	def compileTemplateDoctorViewJS(ArrayList<Feature> comments)
	'''
	'use strict';
	
	angular.module('myApp.templateDoctor', ['ngRoute'])
	
	.controller('templateDoctorCtrl', ['$rootScope', '$scope', '«classToServe.name.toFirstLower»', '$location', function ($rootScope, $scope, «classToServe.name.toFirstLower», $location) {
			
			$scope.continuePerfil=function(){
	              $location.path("DoctorProfile");
	         };
			
	      $scope.continueLogoutD=function(){
	            $rootScope.logout();
	      };
	      $scope.continueHomeD=function(){
	            $location.path("HomeDoctor");
	      };
	      «FOR diag : diagnostics»
	      $scope.continueRegistersP«diag.name.toFirstUpper»=function(){
	      		$location.path("RegisterDoctorView«diag.name.toFirstUpper»");
	      };
	      «ENDFOR»
			«FOR comm: comments»
$scope.continueCommentRegister«comm.name.toFirstUpper»=function(){
        $location.path("CommentRegister«comm.name.toFirstUpper»");
  };
  $scope.continueCommentView«comm.name.toFirstUpper»=function(){
        $location.path("CommentsDoctorView«comm.name.toFirstUpper»");
  };
			«ENDFOR»
	}]);
	'''
	
	
	def compileTemplateDoctorViewHtml(ArrayList<Feature> comments)
	'''
	<div ng-controller="templateDoctorCtrl">
	    <!-- Navigation -->
	    <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
	        <div class="navbar-header">
	            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	                <span class="sr-only">Toggle navigation</span>
	                <span class="icon-bar"></span>
	                <span class="icon-bar"></span>
	                <span class="icon-bar"></span>
	            </button>
	            <a class="navbar-brand" href="index.html">Multiple Client</a>
	        </div>
	        <!-- /.navbar-header -->
	
	        <ul class="nav navbar-top-links navbar-right">
	        	<li><a ng-click="continuePerfil()"><i class="fa fa-user fa-fw"></i> Perfil </a>
	            </li>
	            <li><a ng-click="continueLogoutD()"><i class="fa fa-sign-out fa-fw"></i> Cerrar Sesion</a>
	            </li>
	        </ul>
	        <!-- /.navbar-top-links -->
	
	        <div class="navbar-default sidebar" role="navigation">
	            <div class="sidebar-nav navbar-collapse">
	                <ul class="nav" id="side-menu">
	                    <li>
	                        <a ng-click="continueHomeD()"><i class="fa fa-dashboard fa-fw"></i>Inicio</a>
	                    </li>
	                    «FOR diag: diagnostics»
	                    <li ng-show="FindID">
	                        <a  ng-click="continueRegistersP«diag.name.toFirstUpper»()"><i class="fa fa-bar-chart-o fa-fw"></i> Registros de «diag.name.toFirstUpper»</a>
	                    </li>
                		«ENDFOR»
	                    <li ng-show="FindID">
	                        <a><i class="fa fa-edit fa-fw"></i> Recomendaciones</a>
	                        <ul class="nav nav-second-level">
	                        	«FOR comm: comments»
	                        	<li>
	                        		<a ng-click="continueCommentView«comm.name.toFirstUpper»()">Ver Comentarios «comm.name.toFirstUpper»</a>
	                        	</li>
	                        	<li>
	                        		<a ng-click="continueCommentRegister«comm.name.toFirstUpper»()">Registrar Nuevo Comentario «comm.name.toFirstUpper»</a>
	                        	</li>
	                        	«ENDFOR»
	                        </ul>
	                        <!-- /.nav-second-level -->
	                    </li>
	                </ul>
	            </div>
	            <!-- /.sidebar-collapse -->
	        </div>
	        <!-- /.navbar-static-side -->
	    </nav>
	</div>
	'''
	
	//Create TemplateInvestigatorView
	
	def compileTemplateInvestigatorViewJS(ArrayList<Feature> diagnostics)
	'''
	'use strict';
	
	angular.module('myApp.templateInvestigator', ['ngRoute'])
	
	
	.controller('templateInvestigatorCtrl', ['$rootScope', '$scope', '$location', function ($rootScope, $scope, $location) {
		
		  $scope.continuePerfil=function(){
	            $location.path("InvestigatorProfile");
	      };
	      $scope.continueLogoutI=function(){
	            $rootScope.logout();
	      };
	      $scope.continueHomeI=function(){
	            $location.path("HomeInvestigator");
	      };
		«FOR diag: diagnostics»
		$scope.continueRegistersI«diag.name.toFirstUpper»=function(){
		        $location.path("RegistersInvestigatorView«diag.name.toFirstUpper»");
		  };
		«ENDFOR»
	}]);
	'''
	
	
	def compileTemplateInvestigatorViewHtml(ArrayList<Feature> diagnostics)
	'''
	<meta charset="windows-1252">
	<div ng-controller="templateInvestigatorCtrl">
	    <!-- Navigation -->
	    <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
	        <div class="navbar-header">
	            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	                <span class="sr-only">Toggle navigation</span>
	                <span class="icon-bar"></span>
	                <span class="icon-bar"></span>
	                <span class="icon-bar"></span>
	            </button>
	            <a class="navbar-brand" href="index.html">Multiple Client</a>
	        </div>
	        <!-- /.navbar-header -->
	
	        <ul class="nav navbar-top-links navbar-right">
	        	<li><a ng-click="continuePerfil()"><i class="fa fa-user fa-fw"></i> Perfil </a>
	            </li>
	            <li><a ng-click="continueLogoutI()"><i class="fa fa-sign-out fa-fw"></i> Cerrar Sesion</a>
	            </li>
	        </ul>
	        <!-- /.navbar-top-links -->
	
	        <div class="navbar-default sidebar" role="navigation">
	            <div class="sidebar-nav navbar-collapse">
	                <ul class="nav" id="side-menu">
	                    <li>
	                        <a ng-click="continueHomeI()"><i class="fa fa-dashboard fa-fw"></i>Inicio</a>
	                    </li>
	                    «FOR diag: diagnostics»
	                    <li>
	                    <a  ng-click="continueRegistersI«diag.name.toFirstUpper»()"><i class="fa fa-bar-chart-o fa-fw"></i> Registros del Estudio «diag.name.toFirstUpper» </a>
	                    </li>                
	                    «ENDFOR»
	                </ul>
	            </div>
	            <!-- /.sidebar-collapse -->
	        </div>
	        <!-- /.navbar-static-side -->
	    </nav>
	</div>
	'''
	
	//Create index.html
	def compileIndexHtml(ArrayList<JSModuleData> modules)
		'''
		<!DOCTYPE html>
		<!--[if lt IE 7]>      <html lang="en" ng-app="myApp" class="no-chart lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
		<!--[if IE 7]>         <html lang="en" ng-app="myApp" class="no-chart lt-ie9 lt-ie8"> <![endif]-->
		<!--[if IE 8]>         <html lang="en" ng-app="myApp" class="no-chart lt-ie9"> <![endif]-->
		<!--[if gt IE 8]><!--> <html lang="en" ng-app="myApp" class="no-js"> <!--<![endif]-->
		<head>
		
		  <![endif]-->
		  <meta charset="utf-8">
		  <meta http-equiv="X-UA-Compatible" content="IE=edge">
		  <title>My AngularJS App</title>
		  <meta name="description" content="">
		  <meta name="viewport" content="width=device-width, initial-scale=1">
		  <link rel="stylesheet" href="bower_components/html5-boilerplate/dist/css/normalize.css">
		  <link rel="stylesheet" href="bower_components/html5-boilerplate/dist/css/main.css">
		  <link rel="stylesheet" href="app.css">
		  <!-- Bootstrap Core CSS -->
		  <link href="/app/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		
		  <!-- MetisMenu CSS -->
		  <link href="/app/vendor/metisMenu/metisMenu.min.css" rel="stylesheet">
		
		  <!-- Custom CSS -->
		  <link href="/app/dist/css/sb-admin-2.css" rel="stylesheet">
		
		  <!-- Custom Fonts -->
		  <link href="/app/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
		  <script src="/app/bower_components/html5-boilerplate/dist/js/vendor/modernizr-2.8.3.min.js"></script>
		
		  <!-- HTML5 Shim and Respond.chart IE8 support of HTML5 elements and media queries -->
		  <!-- WARNING: Respond.chart doesn't work if you view the page via file:// -->
		  <!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		</head>
		<body>
		  <!--[if lt IE 7]>
		      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
		  <![endif]-->
		
		  <div ng-view></div>
		
		  <div>Cliente Multiple app: v<span app-version></span></div>
		
		  <!-- In production use:
		  <script src="//ajax.googleapis.com/ajax/libs/angularjs/x.x.x/angular.min.chart"></script>
		  -->
		  <script src="bower_components/angular/angular.js"></script>
		  <script src="bower_components/angular-route/angular-route.js"></script>
		  <script src="bower_components/angular-resource/angular-resource.js"></script>
		  <script src="bower_components/chart.js/dist/Chart.min.js"></script>
		  <script src="bower_components/angular-chart.js/dist/angular-chart.min.js"></script>
		  <script src="app.js"></script>
		  <script src="Login/Login.js"></script>
		  <script src="Register/Register.js"></script>
		  <script src="PatientAutorization/PatientAutorization.js"></script>
		  <script src="Templates/templateInvestigator.js"></script>
		  <script src="Templates/templateDoctor.js"></script>
		  <script src="Templates/templatePatient.js"></script>
		  <script src="HomeInvestigator/HomeInvestigator.js"></script>
		  <script src="HomeDoctor/HomeDoctor.js"></script>
		  <script src="HomePatient/HomePatient.js"></script>
		  <script src="UpdatePerson/UpdatePerson.js"></script>
		  <script src="PatientProfile/PatientProfile.js"></script>
		  <script src="DoctorProfile/DoctorProfile.js"></script>
		  <script src="InvestigatorProfile/InvestigatorProfile.js"></script>
		  «FOR m: modules»
		  <script src="«m.htmlSRCString»"></script>
		  «ENDFOR»
		  <script src="/app/dist/js/sb-admin-2.js"></script>
		  <script src="services/services.js"></script>
		  <script src="components/version/version.js"></script>
		  <script src="components/version/version-directive.js"></script>
		  <script src="components/version/interpolate-filter.js"></script><!-- jQuery -->
		  <script src="/app/vendor/jquery/jquery.min.js"></script>
		
		  <!-- Bootstrap Core JavaScript -->
		  <script src="/app/vendor/bootstrap/js/bootstrap.min.js"></script>
		
		  <!-- Metis Menu Plugin JavaScript -->
		  <script src="/app/vendor/metisMenu/metisMenu.min.js"></script>
		
		
		</body>
		</html>
		
		'''
	
	//Create app.js
	def compileAppJS(ArrayList<JSModuleData> modules)
		'''
		'use strict';
		
		angular.module('myApp', [
		  'ngRoute',
		  «FOR m : modules»
		  '«m.JSAppModuleString»',
		  «ENDFOR»
		  'myApp.templateDoctor',
		  'myApp.HomePatient',
		  'myApp.UpdatePerson',
		  'myApp.PatientProfile',
		  'myApp.DoctorProfile',
		  'myApp.InvestigatorProfile',
		  'myApp.templateInvestigator',
		  'myApp.templatePatient',
		  'myApp.Login',
		  'myApp.Register',
		  'myApp.HomeInvestigator',
		  'myApp.PatientAutorization',
		  'myApp.HomeDoctor',
		  'myApp.version',
		  'services.factory',
		  'chart.js'
		]).
		config(['$locationProvider', '$routeProvider', function($locationProvider, $routeProvider) {
		  $locationProvider.hashPrefix('!');
		
		  $routeProvider.otherwise({redirectTo: '/Login'});
		}]);
		
		'''
	
	//Feature must be diagnostic
	def compileRegistersInvestigatorViewJS(Feature f)
		'''
		'use strict';
		
		angular.module('myApp.RegistersInvestigatorView«f.name.toFirstUpper»', ['ngRoute'])
		
		.config(['$routeProvider', function($routeProvider) {
		  $routeProvider.when('/RegistersInvestigatorView«f.name.toFirstUpper»', {
		    templateUrl: 'RegistersInvestigatorView«f.name.toFirstUpper»/RegistersInvestigatorView«f.name.toFirstUpper».html',
		    controller: 'RegistersInvestigatorView«f.name.toFirstUpper»Ctrl'
		  });
		}])
		
		.controller('RegistersInvestigatorView«f.name.toFirstUpper»Ctrl', ['«classToServe.name.toFirstLower»', '«classToServe.name.toFirstLower»s', '$rootScope', '$scope', function («classToServe.name.toFirstLower», «classToServe.name.toFirstLower»s, $rootScope, $scope) {
		     «classToServe.name.toFirstLower»s.get()
		        .$promise.then(
		                //success
		                function( value ){
		                    $scope.«classToServe.name.toFirstLower»sList=value;
		                    «var intPropCounter=0»
		                    «FOR dat: f.type.eAllContents.toIterable»
		                    «var feature =dat as Feature»
            				«IF((feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
            				$scope.«dat.fullyQualifiedName.lastSegment»=[];
            				//«intPropCounter=intPropCounter+1»
		                    «ENDIF»
		                    «ENDFOR»
		                    $scope.labels=[];
		                    $scope.diagnostics=[];
		                    $scope.series = ['Datos de Control del estudio «f.name.toFirstUpper»'];
		                    $scope.principalAndDiagnostic=[];
		                    for (var i = 0; i < $scope.«classToServe.name.toFirstLower»sList.length; i++) {
		                        if($scope.«classToServe.name.toFirstLower»sList[i].«f.name».length >= 1){
		                            $scope.«classToServe.name.toFirstLower»Act=$scope.«classToServe.name.toFirstLower»sList[i];
		                            $scope.labels.push($scope.«classToServe.name.toFirstLower»Act.id);
		                            «FOR dat: f.type.eAllContents.toIterable»
        		                    «var feature =dat as Feature»
                    				«IF((feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
                    				var «dat.fullyQualifiedName.lastSegment»Initial=0;
        		                    «ENDIF»
        		                    «ENDFOR»
		                            for(var n=0; n<$scope.«classToServe.name.toFirstLower»Act.«f.name».length; n++){
		                                var dd=$scope.«classToServe.name.toFirstLower»Act.«f.name»[n];
		                                «FOR dat: f.type.eAllContents.toIterable»
            		                    «var feature =dat as Feature»
                        				«IF((feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
                        				«dat.fullyQualifiedName.lastSegment»Initial=«dat.fullyQualifiedName.lastSegment»Initial+dd.«dat.fullyQualifiedName.lastSegment»;
            		                    «ENDIF»
            		                    «ENDFOR»
		$scope.principalAndDiagnostic.push([$scope.«classToServe.name.toFirstLower»Act.id, $scope.«classToServe.name.toFirstLower»Act.name
		«FOR dat: f.type.eAllContents.toIterable»
        «var feature =dat as Feature»
		«IF((feature.type.name.equals("Date"))||(feature.type.name.equals("String"))||(feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
		, dd.«dat.fullyQualifiedName.lastSegment»
        «ENDIF»
        «ENDFOR» 
		]);
		                            }
		                            «FOR dat: f.type.eAllContents.toIterable»
        		                    «var feature =dat as Feature»
                    				«IF((feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
                    				$scope.«dat.fullyQualifiedName.lastSegment».push(«dat.fullyQualifiedName.lastSegment»Initial/$scope.«classToServe.name.toFirstLower»Act.«f.name».length);
        		                    «ENDIF»
        		                    «ENDFOR»
		                            
		                            $scope.diagnostics.push($scope.«classToServe.name.toFirstLower»sList[i].«f.name»[0]);
		                        }
		                    }
		                    «var validName=""»
		                    «FOR dat: f.type.eAllContents.toIterable»
		                    «var feature =dat as Feature»
            				«IF((feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
            				«validName=dat.fullyQualifiedName.lastSegment»
            				«dat.fullyQualifiedName.lastSegment»Initial=0;
		                    «ENDIF»
		                    «ENDFOR»
		                    for(var j = 0; j < $scope.«validName».length; j++) {
		                    	«FOR dat: f.type.eAllContents.toIterable»
			                    «var feature =dat as Feature»
	            				«IF((feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
	            				«dat.fullyQualifiedName.lastSegment»Initial=«dat.fullyQualifiedName.lastSegment»Initial+$scope.«dat.fullyQualifiedName.lastSegment»[j];
			                    «ENDIF»
			                    «ENDFOR»
		                    }
		                    $scope.todoData=[];
		                    «FOR dat: f.type.eAllContents.toIterable»
		                    «var feature =dat as Feature»
            				«IF((feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
            				$scope.todoData.push(«dat.fullyQualifiedName.lastSegment»Initial/$scope.«dat.fullyQualifiedName.lastSegment».length);
		                    «ENDIF»
		                    «ENDFOR»
							$scope.todoLabels=[
		                    «FOR dat: f.type.eAllContents.toIterable»
		                    «var feature =dat as Feature»
            				«IF((feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
            				'«dat.fullyQualifiedName.lastSegment.toFirstUpper»'
            				«IF(intPropCounter>1)»
            				,
            				«ENDIF»
            				//«intPropCounter=intPropCounter-1»
		                    «ENDIF»
		                    «ENDFOR»
		                    ];
		                },
		                //error
		                function( error ){
		                    alert("El paciente no se encuentra registrado");
		                }
		        );
		}]);
		'''
	def compileRegistersInvestigatorViewHtml(Feature f)
		'''
		<div ng-include="'/app/Templates/templateInvestigator.html'"></div>
		<div id="page-wrapper">
		    <div class="row">
		        <div class="col-lg-12">
		            <h1 class="page-header">Datos de control del estudio «f.name.toFirstUpper»</h1>
		        </div>
		        <!-- /.col-lg-12 -->
		    </div>
		    <div class="row">
		        <div class="col-lg-4">
		            <div class="panel panel-default">
		                <div class="panel-heading">
		                    Datos Promedio por cada Dato Capturado
		                </div>
		                <div class="panel-body">
		                    <canvas  id="todoData" class="chart chart-bar"
		                             chart-data="todoData" chart-labels="todoLabels" chart-series="series">
		                    </canvas>
		                </div>
		                <!-- /.panel-body -->
		            </div>
		            <!-- /.panel -->
		        </div>
		        <!-- /.col-lg-4 -->
		    </div>
		    <div class="row">
				«FOR dat: f.type.eAllContents.toIterable»
				«var feature =dat as Feature»
				«IF((feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
				<div class="col-lg-4">
				<div class="panel panel-default">
				<div class="panel-heading">
		                    «dat.fullyQualifiedName.lastSegment.toFirstUpper» (Promedio de cada participante)
				</div>
				<div class="panel-body">
				<canvas  id="«dat.fullyQualifiedName.lastSegment»" class="chart chart-bar"
				chart-data="«dat.fullyQualifiedName.lastSegment»" chart-labels="labels" chart-series="series">
				</canvas>
				</div>
				<!-- /.panel-body -->
				</div>
				<!-- /.panel -->
				</div>
				<!-- /.col-lg-4 -->
		        «ENDIF»
		        «ENDFOR»
		    </div>
		    	<div class="row">
		            <div class="col-lg-12">
		                <div class="panel panel-default">
		                    <div class="panel-heading">
		                        Datos totales de cada control de los participantes del estudio.
		                    </div>
		                    <!-- /.panel-heading -->
		                    <div class="panel-body">
		                    	<label>Filtrar por: </label>
								<input type="text" ng-model="busqueda">
		                        <table width="100%" class="table table-striped table-bordered table-hover" id="dataTables-example">
		                            <thead>
		                            <tr>
		                            	<th>Identificador</th>
										<th>Nombre</th>
		                                «FOR dat: f.type.eAllContents.toIterable»
                        				«var feature =dat as Feature»
                        				«IF((feature.type.name.equals("Date"))||(feature.type.name.equals("String"))||(feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
                        				<th>«dat.fullyQualifiedName.lastSegment.toFirstUpper»</th>
                        				«ENDIF»
                        				«ENDFOR»
		                            </tr>
		                            </thead>
		                            <tbody>
		                            <tr ng-repeat="d in principalAndDiagnostic | filter: busqueda" >
		                            	<td>{{d[0]}}</td>
										<td>{{d[1]}}</td>
		                                «var nf=2»
		                                «FOR dat: f.type.eAllContents.toIterable»
                        				«var feature =dat as Feature»
                        				«IF((feature.type.name.equals("String"))||(feature.type.name.equals("Byte"))||(feature.type.name.equals("Double"))||(feature.type.name.equals("Float"))||(feature.type.name.equals("Integer"))||(feature.type.name.equals("Long"))||(feature.type.name.equals("Short")))»
                        				<td>{{d[«nf++»]}}</td>
                        				«ENDIF»
                        				«IF(feature.type.name.equals("Date"))»
                        				<td>{{d[«nf++»] | date:"dd/MMMM/yyyy"}}</td>
                        				«ENDIF»
                        				«ENDFOR»
		                            </tr>
		                            </tbody>
		                        </table>
		                        <!-- /.table-responsive -->
		                    </div>
		                    <!-- /.panel-body -->
		                </div>
		                <!-- /.panel -->
		            </div>
		            <!-- /.col-lg-12 -->
		        </div>
		</div>
		<!-- /#page-wrapper -->
		'''
	
	def compileJSServices(Entity e)
		'''
		'use strict';
		
		angular.module('services.factory', ['ngRoute', 'ngResource'])
		.factory('«e.name.toFirstLower»', function($resource){
			return $resource('/«e.name.toFirstLower»/:«e.name.toFirstLower»Id',{id:"@_«e.name.toFirstLower»Id"},{get: { method: 'GET'}});
		})
		.factory('«e.name.toFirstLower»s', function($resource) {
			return $resource('/«e.name.toFirstLower»',{},{ 'get': { method: 'GET', isArray: true}, 'update': { method: 'PUT', isArray: false}});
		})
		.factory('new«e.name»', function($resource) {
			return $resource('/«e.name.toFirstLower»/new');
		})
		;
		'''
		
	def compileJpaService(Entity e)
		'''
		package «((e.fullyQualifiedName.toString(".").replace(".model."+e.name, "")) + ".jpa;")»
		
		import «e.fullyQualifiedName.toString(".")»;
		import org.springframework.data.repository.CrudRepository;
		import org.springframework.stereotype.Service;
		
		@Service
		public class «e.name»Service implements GenericService<«e.name», Long> {
		
		    private final «e.name»Repository «e.name.toFirstLower»Repository;
		
		    public «e.name»Service(final «e.name»Repository «e.name.toFirstLower»Repository) {
		
		        this.«e.name.toFirstLower»Repository=«e.name.toFirstLower»Repository;
		    }
		
		    @Override
		    public Long getId(«e.name» entity) {
		        return entity.getId();
		    }
		
		    @Override
		    public CrudRepository<«e.name», Long> getRepository() {
		        return this.«e.name.toFirstLower»Repository;
		    }
		
		    @Override
		    public «e.name» save(«e.name» entity) {
		        return GenericService.super.save(entity);
		    }
		}
		'''
	
	def compileRepository(Entity e)
		'''
		package «((e.fullyQualifiedName.toString(".").replace(".model."+e.name, "")) + ".jpa;")»
		
		import «e.fullyQualifiedName.toString(".")»;
		import org.springframework.data.jpa.repository.JpaRepository;
		
		import javax.transaction.Transactional;
		
		
		@Transactional
		public interface «e.name»Repository extends JpaRepository<«e.name», Long>  {
		}
		
		'''
	
	def compileMainClass(Entity e)
		'''
		package «((e.fullyQualifiedName.toString(".").replace(".model."+e.name, "")))»;
		
		import org.springframework.boot.SpringApplication;
		import org.springframework.boot.autoconfigure.SpringBootApplication;
		import org.springframework.boot.autoconfigure.security.SecurityProperties;
		import org.springframework.context.annotation.Configuration;
		import org.springframework.core.annotation.Order;
		import org.springframework.data.jpa.repository.config.EnableJpaRepositories;
		import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
		import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;
		import org.springframework.security.config.annotation.web.builders.HttpSecurity;
		import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
		import org.springframework.security.web.csrf.CsrfFilter;
		import org.springframework.security.web.csrf.CsrfToken;
		import org.springframework.security.web.csrf.CsrfTokenRepository;
		import org.springframework.security.web.csrf.HttpSessionCsrfTokenRepository;
		import org.springframework.web.filter.OncePerRequestFilter;
		import org.springframework.web.util.WebUtils;
		
		import javax.servlet.FilterChain;
		import javax.servlet.ServletException;
		import javax.servlet.http.Cookie;
		import javax.servlet.http.HttpServletRequest;
		import javax.servlet.http.HttpServletResponse;
		import java.io.IOException;
		
		@SpringBootApplication
		@EnableJpaRepositories
		public class demoApplication {
		
		
			public static void main(String[] args) {
				SpringApplication.run(demoApplication.class, args);
			}
		
		
		
			@Configuration
			@EnableGlobalMethodSecurity(prePostEnabled = true)
			@Order(SecurityProperties.ACCESS_OVERRIDE_ORDER)
			protected static class SecurityConfiguration extends WebSecurityConfigurerAdapter {
		
				@Override
				protected void configure(AuthenticationManagerBuilder builder) throws Exception {
					builder.inMemoryAuthentication().withUser("12dea96fec20593566ab75692c9949596833adc9").password("5baa61e4c9b93f3f0682250b6cf8331b7ee68fd8").roles("USER");
				}
		
				@Override
				protected void configure(HttpSecurity http) throws Exception {
					http
							.httpBasic()
							.and()
							.authorizeRequests()
							.antMatchers("/app/**","/logout","/app/user**", "/«e.name.toFirstLower»/new").permitAll()
							.anyRequest().authenticated().and()
							.logout().logoutSuccessUrl("/")
							.and().csrf()
							.csrfTokenRepository(csrfTokenRepository()).and()
							.addFilterAfter(csrfHeaderFilter(), CsrfFilter.class)
							.formLogin()
							.loginPage("/app/index.html");
				}
		
				private OncePerRequestFilter csrfHeaderFilter() {
					return new OncePerRequestFilter() {
						@Override
						protected void doFilterInternal(HttpServletRequest request,
														HttpServletResponse response, FilterChain filterChain)
								throws ServletException, IOException {
							CsrfToken csrf = (CsrfToken) request.getAttribute(CsrfToken.class
									.getName());
							if (csrf != null) {
								Cookie cookie = WebUtils.getCookie(request, "XSRF-TOKEN");
								String token = csrf.getToken();
								if (cookie == null || token != null
										&& !token.equals(cookie.getValue())) {
									cookie = new Cookie("XSRF-TOKEN", token);
									cookie.setPath("/");
									response.addCookie(cookie);
								}
							}
							filterChain.doFilter(request, response);
						}
					};
				}
		
				private CsrfTokenRepository csrfTokenRepository() {
					HttpSessionCsrfTokenRepository repository = new HttpSessionCsrfTokenRepository();
					repository.setHeaderName("X-XSRF-TOKEN");
					return repository;
				}
		
			}
		}
		'''
	
	def compileRESTControllers(Entity e)
		'''
		package «((e.fullyQualifiedName.toString(".").replace(".model."+e.name, "")) + ".controller;")»
		
		import «e.fullyQualifiedName.toString(".")»;
		import «((e.fullyQualifiedName.toString(".").replace(".model."+e.name, "")) + ".services")».«e.name»Services;
		import org.springframework.beans.factory.annotation.Autowired;
		import org.springframework.http.HttpStatus;
		import org.springframework.http.ResponseEntity;
		import org.springframework.web.bind.annotation.*;
		import java.util.List;
		
		@RestController
		@RequestMapping(value = "/«e.name.toFirstLower»")
		public class «e.name»Controller {
		
		    @Autowired
		    private «e.name»Services ps;
		
		    @RequestMapping(method = RequestMethod.GET)
		    public ResponseEntity<?> get«e.name»s(){
		    	List<«e.name»> ans=ps.get«e.name»s();
				if(ans!=null){
					return new ResponseEntity<>(ans , HttpStatus.ACCEPTED);
				}else{
					return new ResponseEntity<>(HttpStatus.NOT_FOUND);
				}
		    }
		
		    @RequestMapping(method = RequestMethod.GET, path = "/{«e.name.toFirstLower»Id}")
		    public ResponseEntity<?> get«e.name»(@PathVariable Long «e.name.toFirstLower»Id) {
				«e.name» ans=ps.get«e.name»(«e.name.toFirstLower»Id);
				if(ans!=null){
					return new ResponseEntity<>(ans , HttpStatus.ACCEPTED);
				}else{
					return new ResponseEntity<>(HttpStatus.NOT_FOUND);
				}
		    }
		
		    @RequestMapping(method = RequestMethod.POST, path = "/new")
		    public ResponseEntity<?> post«e.name»(@RequestBody «e.name» p) {
		        ps.save«e.name»(p);
		        return new ResponseEntity<>(HttpStatus.ACCEPTED);
		    }
		
		    @RequestMapping(method = RequestMethod.PUT)
		    public ResponseEntity<?> update«e.name»(@RequestBody «e.name» p) {
		        ps.update«e.name»(p);
		        return new ResponseEntity<>(HttpStatus.ACCEPTED);
		    }
		}
		'''
		
	def compileServiceImplementation2(Entity e)
		'''
		package  «((e.fullyQualifiedName.toString(".").replace(".model."+e.name, "")) + ".services;")»
		import «e.fullyQualifiedName.toString(".")»;
		import org.springframework.stereotype.Service;
		import com.example.jpa.GenericService;
		import org.springframework.beans.factory.annotation.Autowired;
		
		import java.util.ArrayList;
		import java.util.List;

		@Service
		public class «e.name»ServicesImpl2 implements «e.name»Services{
		
		    @Autowired
		    private GenericService ps;
		    
		    public «e.name»ServicesImpl2(final GenericService gs){
		        this.ps=gs;
		    }
		
		    @Override
		    public void save«e.name»(«e.name» p) {
		        ps.save(p);
		    }
		
		    @Override
		    public List<«e.name»> get«e.name»s() {
			ArrayList<«e.name»> ans =new ArrayList<«e.name»>();
			for (Object o : ps.findAll()) {
			ans.add((«e.name») o);
			}
			return ans;
		    }
		
		    @Override
		    public void update«e.name»(«e.name» p) {
		    	ps.update(p);
		    }
		
		
		    @Override
		    public «e.name» get«e.name»(Long pId) {
		        return («e.name») ps.get(pId);
		    }
		}
		'''
	
	def compileServiceImplementation(Entity e)
		'''
		package  «((e.fullyQualifiedName.toString(".").replace(".model."+e.name, "")) + ".services;")»
		import «e.fullyQualifiedName.toString(".")»;
		import org.springframework.stereotype.Service;
		
		import java.util.ArrayList;
		import java.util.List;

		public class «e.name»ServicesImpl1 implements «e.name»Services{
		
		    List<«e.name»> «e.name.toFirstLower»List=new ArrayList<>();
		
		    @Override
		    public void save«e.name»(«e.name» p) {
		        «e.name.toFirstLower»List.add(p);
		    }
		
		    @Override
		    public List<«e.name»> get«e.name»s() {
		        return «e.name.toFirstLower»List;
		    }
		
		    @Override
		    public void update«e.name»(«e.name» p) {
		    	for (int i = 0; i < «e.name.toFirstLower»List.size(); i++) {
					if(p.getId().equals(«e.name.toFirstLower»List.get(i).getId())){
    	                «e.name.toFirstLower»List.set(i, p);
					}
				}
		    }
		
		
		    @Override
		    public «e.name» get«e.name»(Long pId) {
		        «e.name» ans=null;
		        for («e.name» pe :
		                «e.name.toFirstLower»List) {
		            if(pe.getId().equals(pId)){
		                ans=pe;
		                break;
		            }
		        }
		        return ans;
		    }
		}
		'''
	
	def compileServiceInterface(Entity e)
		'''
		package  «((e.fullyQualifiedName.toString(".").replace(".model."+e.name, "")) + ".services;")»
		import «e.fullyQualifiedName.toString(".")»;
		import java.util.List;
		
		public interface «e.name»Services {
		    public void save«e.name»(«e.name» p);
		    public List<«e.name»> get«e.name»s();
		    public void update«e.name»(«e.name» p);
		    public «e.name» get«e.name»(Long pId);
		}
		'''
	
	def compile(Entity e) 
	''' 
        «IF e.eContainer.fullyQualifiedName !== null»
package 
		«e.eContainer.fullyQualifiedName»;
        «ENDIF»
	    
        «FOR i : e.imports»
import «i.importedNamespace»;
	    «ENDFOR»
	    import javax.persistence.*;
	    import java.util.Calendar;
	    «IF e.principal»
	    @SuppressWarnings("all")
	    «ENDIF»
	    «IF(GeneralEvaluator.entityIsEmbeddable(e, principalEmbeddableFeatures))»
	    @Embeddable
	    «ELSE»
	    @Entity
	    @Table(name = "«e.name.toFirstLower»s", schema = "application")
	    «ENDIF»
public class «e.name» «IF e.superType !== null»extends «e.superType.fullyQualifiedName» «ENDIF»{
	public «e.name»(){}
	«IF(!GeneralEvaluator.entityIsEmbeddable(e, principalEmbeddableFeatures))»
	@Id
	«IF e.principal»
	@Column(name = "id")
	«ELSE»
	@GeneratedValue(strategy = GenerationType.AUTO)
	@Column(name = "«e.name.toFirstLower»_id")
	«ENDIF»
	private Long id;
		
	public Long getId() {
	return id;
	}
	
	public void setId(Long id) {
	this.id = id;
	}
	«ENDIF»
            «FOR f : e.features»
            	«IF !f.name.equals("id")»
                	«f.compile»
            	«ENDIF»
            «ENDFOR»
        }
    '''
 
    def compile(Feature f)
    '''
    	«IF f.many»
@OneToMany(cascade = CascadeType.ALL)
			@JoinColumns(
					{
							@JoinColumn(name = "«f.type.fullyQualifiedName.lastSegment.toFirstLower»", referencedColumnName = "id", nullable = false),
					}
			)
			«IF f.type.fullyQualifiedName.lastSegment.equals("Date")»
			private java.util.List<Calendar> «f.name» =new java.util.ArrayList<Calendar>();
			public java.util.List<Calendar> get«f.name.toFirstUpper»() {
			return «f.name»;
			}
			public void set«f.name.toFirstUpper»(java.util.ArrayList<Calendar> «f.name») {
			this.«f.name» = «f.name»;
			}
    		«ELSE»
			private java.util.List<«f.type.fullyQualifiedName»> «f.name» =new java.util.ArrayList<«f.type.fullyQualifiedName»>();
			public java.util.List<«f.type.fullyQualifiedName»> get«f.name.toFirstUpper»() {
			return «f.name»;
			}
			public void set«f.name.toFirstUpper»(java.util.ArrayList<«f.type.fullyQualifiedName»> «f.name») {
			this.«f.name» = «f.name»;
			}
    		«ENDIF»
    	«ELSE»
    		«IF f.type.fullyQualifiedName.lastSegment.equals("Date")»
    		@Column(name = "«f.name»")
    		private Calendar «f.name»;
    		
    		public Calendar get«f.name.toFirstUpper»() {
    		return «f.name»;
    		}
    		
    		public void set«f.name.toFirstUpper»(Calendar «f.name») {
    		this.«f.name» = «f.name»;
    		}
    		«ELSE»
    		«IF(GeneralEvaluator.typeIsPrimitive(f.type))»
    		@Column(name = "«f.name»")
    		«ELSE»
    		@Embedded
    		«ENDIF»
    		private «f.type.fullyQualifiedName» «f.name»;
    		
    		public «f.type.fullyQualifiedName» get«f.name.toFirstUpper»() {
    		return «f.name»;
    		}
    		
    		public void set«f.name.toFirstUpper»(«f.type.fullyQualifiedName» «f.name») {
    		this.«f.name» = «f.name»;
    		}
    		«ENDIF»
    	«ENDIF»
    '''
}
